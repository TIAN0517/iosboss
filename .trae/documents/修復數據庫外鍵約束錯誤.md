# 修復數據庫外鍵約束錯誤 (LineMessage_lineGroupId_fkey)

## 問題根源
`LineMessage.lineGroupId` 外鍵指向 `LineGroup.id`，但程式直接使用 LINE 的 `groupId` 而非資料庫內部 `id`

## 修復計劃

### 1. 修復 Next.js Webhook (app/api/webhook/line/route.ts)
修改 `saveLineMessage` 函數：
- 接收 `lineGroupId` (LINE 的 groupId)
- 先查詢 `LineGroup` 表，用 `groupId` 找到對應的內部 `id`
- 使用資料庫的內部 `id` 作為外鍵值
- 如果群組不存在，自動創建記錄後再保存訊息

### 2. 修復 Python Boss LINE Bot (line_bot_ai/boss_line_bot.py)
修改 `ensure_group_exists` 函數：
- 修正 SQL 查詢條件，使用正確的 `groupId` 欄位
- 確保返回資料庫內部的 `id`

### 3. 修復 Python Knowledge LINE Bot (line_bot_ai/knowledge_line_bot.py)
應用相同的修復邏輯

## 預期效果
- ✅ Webhook 接收訊息時不再觸發外鍵約束錯誤
- ✅ 自動創建不存在的群組記錄
- ✅ 所有 LINE 訊息正確保存到數據庫