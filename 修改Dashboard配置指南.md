# ä¿®æ”¹ Cloudflare Dashboard é…ç½®æŒ‡å—

## ğŸ¯ ç›®æ¨™

å°‡ Cloudflare Tunnel çš„ Service é…ç½®å¾ `http://localhost:9999` æ”¹ç‚º `http://nginx:80`

## ğŸ“‹ æ­¥é©Ÿ

### 1. ç™»å…¥ Cloudflare Dashboard
- ç¶²å€ï¼šhttps://one.dash.cloudflare.com/
- ä½¿ç”¨æ‚¨çš„ Cloudflare å¸³è™Ÿç™»å…¥

### 2. é€²å…¥ Tunnel é…ç½®
1. é»æ“Šå·¦å´é¸å–®ï¼š**Zero Trust**
2. é»æ“Šï¼š**Networks** > **Tunnels**
3. æ‰¾åˆ°æ‚¨çš„ Tunnelï¼š**linebot-webhook-final**
4. é»æ“Š Tunnel åç¨±æˆ–å³å´çš„ **Configure** æŒ‰éˆ•

### 3. ä¿®æ”¹ Public Hostname
1. åœ¨ Tunnel é…ç½®é é¢ä¸­ï¼Œæ‰¾åˆ° **Public Hostname** å€å¡Š
2. æ‰¾åˆ° Hostname ç‚º `linebot.jytian.it.com` çš„é…ç½®
3. é»æ“Šè©²é…ç½®å³å´çš„ **ç·¨è¼¯**ï¼ˆé‰›ç­†åœ–ç¤ºï¼‰æˆ– **Edit**

### 4. ä¿®æ”¹ Service é…ç½®
åœ¨ç·¨è¼¯é é¢ä¸­ï¼š

**ç•¶å‰é…ç½®ï¼ˆéŒ¯èª¤ï¼‰ï¼š**
```
Service: http://localhost:9999
```

**ä¿®æ”¹ç‚ºï¼ˆæ­£ç¢ºï¼‰ï¼š**
```
Service: http://nginx:80
```

æˆ–è€…ï¼ˆç«¯å£ 80 å¯çœç•¥ï¼‰ï¼š
```
Service: http://nginx
```

### 5. ä¿å­˜é…ç½®
1. é»æ“Š **Save** æˆ– **ä¿å­˜**
2. ç­‰å¾…é…ç½®æ›´æ–°ï¼ˆé€šå¸¸å¹¾ç§’é˜ï¼‰

## âœ… é©—è­‰é…ç½®

### æ–¹æ³• 1ï¼šæŸ¥çœ‹ Docker æ—¥èªŒ
```bash
docker compose logs cloudflared --tail 20
```

æ‡‰è©²çœ‹åˆ°é¡ä¼¼ï¼š
```
Updated to new configuration config="{\"ingress\":[{\"hostname\":\"linebot.jytian.it.com\",\"service\":\"http://nginx:80\"},...]}"
```

### æ–¹æ³• 2ï¼šæ¸¬è©¦å¤–ç¶²è¨ªå•
ç­‰å¾… 5-10 åˆ†é˜å¾Œï¼š
```bash
curl https://linebot.jytian.it.com/api/webhook/line
```

æ‡‰è©²è¿”å›æ­£å¸¸çš„ JSON éŸ¿æ‡‰ï¼Œè€Œä¸æ˜¯ 521 éŒ¯èª¤ã€‚

## ğŸ” ç‚ºä»€éº¼è¦é€™æ¨£æ”¹ï¼Ÿ

### Docker ç¶²çµ¡æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Docker Network: jyt-network     â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  cloudflared â”‚                  â”‚
â”‚  â”‚  (Tunnel)    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ http://nginx:80           â”‚
â”‚         â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚    nginx     â”‚                  â”‚
â”‚  â”‚  (åå‘ä»£ç†)   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ http://app:9999          â”‚
â”‚         â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚     app      â”‚                  â”‚
â”‚  â”‚  (Next.js)   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŸå› èªªæ˜
1. **cloudflared** å’Œ **nginx** åœ¨åŒä¸€å€‹ Docker ç¶²çµ¡ä¸­
2. Docker ç¶²çµ¡ä¸­ï¼Œæœå‹™åç¨±å°±æ˜¯ä¸»æ©Ÿå
3. æ‰€ä»¥ `http://nginx:80` å¯ä»¥æ­£ç¢ºè¨ªå• nginx å®¹å™¨
4. nginx æœƒè‡ªå‹•è½‰ç™¼è«‹æ±‚åˆ° `app:9999`

### ç‚ºä»€éº¼ä¸èƒ½ç”¨ localhost:9999ï¼Ÿ
- `localhost` åœ¨ cloudflared å®¹å™¨å…§æŒ‡å‘å®¹å™¨è‡ªå·±
- cloudflared å®¹å™¨å…§æ²’æœ‰é‹è¡Œ 9999 ç«¯å£çš„æœå‹™
- æ‰€ä»¥æœƒå‡ºç¾ 521 éŒ¯èª¤ï¼ˆç„¡æ³•é€£æ¥ï¼‰

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### Q: ä¿®æ”¹å¾Œé‚„æ˜¯ 521 éŒ¯èª¤ï¼Ÿ
**A:** 
1. ç­‰å¾… 5-10 åˆ†é˜è®“ Cloudflare æ›´æ–°é…ç½®
2. æª¢æŸ¥ Docker æ—¥èªŒç¢ºèªé…ç½®å·²æ›´æ–°
3. ç¢ºèª nginx æœå‹™æ­£å¸¸é‹è¡Œï¼š`docker compose ps nginx`

### Q: æ‰¾ä¸åˆ° Public Hostname é…ç½®ï¼Ÿ
**A:** 
- ç¢ºä¿æ‚¨æœ‰æ­£ç¢ºçš„æ¬Šé™
- æˆ–è€…å˜—è©¦åœ¨ Tunnel çš„ **Routing** æˆ– **Ingress** å€å¡Šä¸­æŸ¥æ‰¾

### Q: å¯ä»¥åŒæ™‚é…ç½®å¤šå€‹ Hostname å—ï¼Ÿ
**A:** 
- å¯ä»¥ï¼Œæ¯å€‹ Hostname å¯ä»¥æœ‰ä¸åŒçš„ Service é…ç½®
- ç¢ºä¿æ¯å€‹é…ç½®éƒ½æŒ‡å‘æ­£ç¢ºçš„æœå‹™

## ğŸ“ é…ç½®ç¯„ä¾‹

### æ­£ç¢ºé…ç½®
```json
{
  "ingress": [
    {
      "hostname": "linebot.jytian.it.com",
      "service": "http://nginx:80"
    },
    {
      "service": "http_status:404"
    }
  ]
}
```

### éŒ¯èª¤é…ç½®
```json
{
  "ingress": [
    {
      "hostname": "linebot.jytian.it.com",
      "service": "http://localhost:9999"  // âŒ éŒ¯èª¤
    }
  ]
}
```

## ğŸ¯ å®Œæˆå¾Œ

ä¿®æ”¹å®Œæˆå¾Œï¼š
1. âœ… ä¿å­˜é…ç½®
2. â³ ç­‰å¾… 5-10 åˆ†é˜
3. ğŸ§ª æ¸¬è©¦å¤–ç¶²è¨ªå•
4. âœ… ç¢ºèªä¸å†å‡ºç¾ 521 éŒ¯èª¤

---

**æœ€å¾Œæ›´æ–°**: 2025-12-28

