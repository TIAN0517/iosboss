# âš¡ å„ªåŒ–éŸ¿æ‡‰é€Ÿåº¦æŒ‡å—

## ğŸ” ç•¶å‰å•é¡Œ

å¤–ç¶²è¨ªå•éŸ¿æ‡‰è¶…æ…¢æˆ– 521 éŒ¯èª¤ã€‚

## âœ… é…ç½®ç¢ºèª

æ ¹æ“šæ‚¨çš„ Cloudflare Dashboardï¼š
- âœ… Hostname: `linebot.jytian.it.com`
- âœ… Service: `http://nginx:80`
- âœ… Capture rules: `http_status:404`

é…ç½®æ˜¯æ­£ç¢ºçš„ï¼

## ğŸš€ å„ªåŒ–æ­¥é©Ÿ

### 1. æ¸…é™¤ Cloudflare ç·©å­˜

åœ¨ Cloudflare Dashboard ä¸­ï¼š
1. è¨ªå•ï¼šhttps://dash.cloudflare.com/
2. é¸æ“‡åŸŸåï¼š`jytian.it.com`
3. é€²å…¥ **Caching** â†’ **Configuration**
4. é»æ“Š **Purge Everything**ï¼ˆæ¸…é™¤æ‰€æœ‰ç·©å­˜ï¼‰

### 2. æª¢æŸ¥ Cloudflare ä»£ç†æ¨¡å¼

1. é€²å…¥ **DNS** è¨­ç½®
2. æ‰¾åˆ° `linebot.jytian.it.com` çš„è¨˜éŒ„
3. ç¢ºèª **ä»£ç†ç‹€æ…‹** æ˜¯ **å·²ä»£ç†**ï¼ˆæ©™è‰²é›²æœµï¼‰âœ…
4. å¦‚æœæ²’æœ‰è¨˜éŒ„ï¼Œæ·»åŠ ä¸€å€‹ï¼š
   - **Type**: CNAME
   - **Name**: `linebot`
   - **Target**: `jytian.it.com` æˆ– `@`
   - **Proxy status**: å·²ä»£ç†ï¼ˆæ©™è‰²é›²æœµï¼‰

### 3. æª¢æŸ¥ SSL/TLS è¨­ç½®

1. é€²å…¥ **SSL/TLS** è¨­ç½®
2. ç¢ºèªæ¨¡å¼æ˜¯ **Full** æˆ– **Full (strict)**
3. ä¸è¦ä½¿ç”¨ **Flexible** æ¨¡å¼ï¼ˆæœƒå°è‡´é€£æ¥å•é¡Œï¼‰

### 4. ç­‰å¾… Cloudflare æ›´æ–°

Cloudflare è·¯ç”±æ›´æ–°é€šå¸¸éœ€è¦ï¼š
- **æœ€å¿«**ï¼š2-5 åˆ†é˜
- **ä¸€èˆ¬**ï¼š5-15 åˆ†é˜
- **æœ€æ…¢**ï¼š15-30 åˆ†é˜

### 5. é‡å•Ÿ Tunnelï¼ˆå¦‚æœéœ€è¦ï¼‰

```powershell
docker compose restart cloudflared
```

## ğŸ§ª æ¸¬è©¦å‘½ä»¤

### æ¸¬è©¦æœ¬åœ°æœå‹™ï¼ˆæ‡‰è©²å¾ˆå¿«ï¼‰
```powershell
curl http://localhost:9999/api/webhook/line
```

### æ¸¬è©¦å¤–ç¶²è¨ªå•
```powershell
curl https://linebot.jytian.it.com/api/webhook/line
```

### æ¸¬è©¦ Nginx ä»£ç†
```powershell
docker compose exec nginx curl http://app:9999/api/webhook/line
```

## ğŸ“‹ æª¢æŸ¥æ¸…å–®

- [ ] Cloudflare ç·©å­˜å·²æ¸…é™¤
- [ ] DNS è¨˜éŒ„å­˜åœ¨ä¸”å·²ä»£ç†
- [ ] SSL/TLS æ¨¡å¼æ˜¯ Full
- [ ] ç­‰å¾… 5-15 åˆ†é˜è®“ Cloudflare æ›´æ–°
- [ ] æ‰€æœ‰æœå‹™é‹è¡Œæ­£å¸¸

## ğŸ¯ å¿«é€Ÿä¿®å¾©

å¦‚æœé‚„æ˜¯ 521 éŒ¯èª¤ï¼Œå˜—è©¦ï¼š

1. **æ¸…é™¤ Cloudflare ç·©å­˜**
2. **ç­‰å¾… 10-15 åˆ†é˜**
3. **é‡å•Ÿ Tunnel**ï¼š
   ```powershell
   docker compose restart cloudflared
   ```
4. **å†æ¬¡æ¸¬è©¦**

## âš¡ æ€§èƒ½å„ªåŒ–å»ºè­°

### Nginx å„ªåŒ–ï¼ˆå·²é…ç½®ï¼‰
- âœ… Keepalive é€£æ¥
- âœ… Gzip å£“ç¸®
- âœ… ç·©è¡å„ªåŒ–

### Cloudflare å„ªåŒ–
- å•Ÿç”¨ **Auto Minify**ï¼ˆCSSã€JavaScriptã€HTMLï¼‰
- å•Ÿç”¨ **Brotli** å£“ç¸®
- è¨­ç½®é©ç•¶çš„ **Cache Level**

---

**ç•¶å‰ç‹€æ…‹**ï¼šé…ç½®æ­£ç¢ºï¼Œç­‰å¾… Cloudflare æ›´æ–°è·¯ç”±å³å¯ã€‚

