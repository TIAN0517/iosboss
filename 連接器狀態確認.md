# Cloudflare Tunnel é€£æ¥å™¨ç‹€æ…‹ç¢ºèª

## âœ… é€£æ¥å™¨è©³ç´°è³‡æ–™

### åŸºæœ¬ä¿¡æ¯
- **é€£æ¥å™¨ID**: `72211803-1666-40ac-a878-cdca95b79ba8`
- **ç‰ˆæœ¬**: `2025.11.1`
- **å¹³å°**: `linux_amd64`
- **ä¸»æ©Ÿåç¨±**: `118c32da135f`

### ç¶²çµ¡ä¿¡æ¯
- **åŸé» IP**: `49.158.236.211`ï¼ˆæœå‹™å™¨å…¬ç¶² IPï¼‰
- **ç§äºº IP**: `172.18.0.5`ï¼ˆDocker ç¶²çµ¡ IPï¼‰
- **è³‡æ–™ä¸­å¿ƒ**: `tpe01, nrt01, nrt05`ï¼ˆ3 å€‹é€£æ¥é»ï¼‰

## ğŸ“Š ç‹€æ…‹åˆ†æ

### âœ… é€£æ¥ç‹€æ…‹
- âœ… **å¤šå€‹é€£æ¥é»å·²å»ºç«‹**
  - tpe01ï¼ˆå°åŒ—ï¼‰
  - nrt01ï¼ˆæ±äº¬ï¼‰
  - nrt05ï¼ˆæ±äº¬ï¼‰
  
- âœ… **ç¶²çµ¡é…ç½®æ­£ç¢º**
  - ç§äºº IP `172.18.0.5` èˆ‡ Docker ç¶²çµ¡ä¸€è‡´
  - åŸé» IP `49.158.236.211` æ˜¯æœå‹™å™¨å…¬ç¶² IP

### âœ… é…ç½®ç‹€æ…‹
- âœ… **Service**: `http://nginx:80`ï¼ˆæ­£ç¢ºï¼‰
- âœ… **Hostname**: `linebot.jytian.it.com`
- âœ… **é…ç½®ç‰ˆæœ¬**: v9
- âœ… **æ‰€æœ‰æœå‹™é‹è¡Œæ­£å¸¸**

## ğŸ” é©—è­‰é€£æ¥

### æª¢æŸ¥é€£æ¥æ—¥èªŒ
```bash
docker compose logs cloudflared | Select-String "Registered"
```

æ‡‰è©²çœ‹åˆ°é¡ä¼¼ï¼š
```
Registered tunnel connection connIndex=0 connection=... location=tpe01
Registered tunnel connection connIndex=1 connection=... location=nrt01
Registered tunnel connection connIndex=2 connection=... location=nrt05
```

### æª¢æŸ¥é…ç½®æ›´æ–°
```bash
docker compose logs cloudflared | Select-String "Updated to new configuration"
```

æ‡‰è©²çœ‹åˆ°ï¼š
```
Updated to new configuration config="...\"service\":\"http://nginx:80\"..." version=9
```

## ğŸ§ª æ¸¬è©¦å¤–ç¶²è¨ªå•

### æ¸¬è©¦å‘½ä»¤
```bash
curl https://linebot.jytian.it.com/api/webhook/line
```

### é æœŸçµæœ
- âœ… **æˆåŠŸ**ï¼šè¿”å› JSON éŸ¿æ‡‰ï¼ˆä¸å† 521 éŒ¯èª¤ï¼‰
- â³ **ç­‰å¾…ä¸­**ï¼šé‚„æ˜¯ 521ï¼ˆæ­£å¸¸ï¼Œéœ€è¦ç­‰å¾… Cloudflare æ›´æ–°ï¼‰

## ğŸ’¡ å¦‚æœé‚„æ˜¯ 521

### 1. ç¢ºèªé€£æ¥å™¨ç‹€æ…‹
- âœ… é€£æ¥å™¨å·²æ­£å¸¸é€£æ¥ï¼ˆ3 å€‹é€£æ¥é»ï¼‰
- âœ… é…ç½®å·²æ­£ç¢ºï¼ˆ`http://nginx:80`ï¼‰
- â³ ç­‰å¾… Cloudflare æ›´æ–°é…ç½®ï¼ˆ5-10 åˆ†é˜ï¼‰

### 2. æ¸…é™¤ç·©å­˜ï¼ˆå¯é¸ï¼‰
åœ¨ Cloudflare Dashboard ä¸­ï¼š
1. é€²å…¥ **Caching** > **Configuration**
2. é»æ“Š **Purge Everything**
3. ç­‰å¾…å¹¾åˆ†é˜å¾Œå†æ¬¡æ¸¬è©¦

### 3. æª¢æŸ¥æœå‹™ç‹€æ…‹
```bash
# æª¢æŸ¥æ‰€æœ‰æœå‹™
docker compose ps

# æª¢æŸ¥ Nginx
docker compose logs nginx --tail 20

# æª¢æŸ¥ App
docker compose logs app --tail 20
```

## ğŸ“‹ å®Œæ•´æ¶æ§‹

```
Internet
   â†“
Cloudflare Edge (tpe01, nrt01, nrt05)
   â†“
Cloudflare Tunnel (é€£æ¥å™¨: 72211803-1666-40ac-a878-cdca95b79ba8)
   â†“ (http://nginx:80)
Nginx (172.18.0.4)
   â†“ (http://app:9999)
Next.js App (172.18.0.3)
```

## ğŸ¯ ç¸½çµ

### âœ… å·²å®Œæˆ
1. âœ… Token å·²è¨­ç½®
2. âœ… Dashboard é…ç½®æ­£ç¢ºï¼ˆ`http://nginx:80`ï¼‰
3. âœ… é€£æ¥å™¨å·²æ­£å¸¸é€£æ¥ï¼ˆ3 å€‹é€£æ¥é»ï¼‰
4. âœ… æ‰€æœ‰æœå‹™é‹è¡Œæ­£å¸¸

### â³ ç­‰å¾…ä¸­
- â³ Cloudflare é…ç½®å®Œå…¨ç”Ÿæ•ˆï¼ˆ5-10 åˆ†é˜ï¼‰

### ğŸ‰ ç‹€æ…‹
**é…ç½®å®Œå…¨æ­£ç¢ºï¼Œé€£æ¥æ­£å¸¸ï¼Œåªéœ€è¦ç­‰å¾… Cloudflare æ›´æ–°å³å¯ï¼**

---

**æœ€å¾Œæ›´æ–°**: 2025-12-28
**é€£æ¥å™¨ID**: 72211803-1666-40ac-a878-cdca95b79ba8
**ç‹€æ…‹**: âœ… æ­£å¸¸é€£æ¥

