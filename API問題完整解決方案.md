# API å•é¡Œå®Œæ•´è§£æ±ºæ–¹æ¡ˆ

## ğŸ” å•é¡Œè¨ºæ–·ç¸½çµ

### å·²ç¢ºèªçš„é…ç½®
- âœ… `.env.docker` æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¢º
- âœ… `docker-compose.yml` ä¸­å·²æ·»åŠ  `env_file` é…ç½®
- âœ… å·²ç§»é™¤ `environment` ä¸­å° `GLM_API_KEYS` å’Œ `GLM_API_KEY` çš„è¨­ç½®
- âœ… `docker-compose config` å¯ä»¥æ­£ç¢ºè®€å–ç’°å¢ƒè®Šé‡

### ç•¶å‰å•é¡Œ
- âŒ å®¹å™¨å…§ç’°å¢ƒè®Šé‡ä»ç„¶æ˜¯ç©ºçš„
- âŒ å®¹å™¨å•Ÿå‹•æ™‚é–“ä»ç„¶æ˜¯ 8 å°æ™‚å‰ï¼ˆæœªé‡æ–°å‰µå»ºï¼‰
- âŒ AI Provider ä¸å¯ç”¨

---

## ğŸ”§ å®Œæ•´è§£æ±ºæ–¹æ¡ˆ

### æ­¥é©Ÿ 1: å¼·åˆ¶é‡æ–°å‰µå»ºå®¹å™¨

**å¿…é ˆåŸ·è¡Œæ­¤æ­¥é©Ÿ**ï¼Œå› ç‚º `env_file` é…ç½®åªåœ¨å®¹å™¨å‰µå»ºæ™‚ç”Ÿæ•ˆï¼š

```bash
# æ–¹æ³• 1: å¼·åˆ¶é‡æ–°å‰µå»ºï¼ˆæ¨è–¦ï¼‰
docker-compose up -d --force-recreate app

# æ–¹æ³• 2: å®Œå…¨é‡å•Ÿï¼ˆå¦‚æœæ–¹æ³• 1 ç„¡æ•ˆï¼‰
docker-compose down
docker-compose up -d

# æ–¹æ³• 3: åˆªé™¤ä¸¦é‡å»ºï¼ˆæœ€å¾¹åº•ï¼‰
docker-compose rm -f app
docker-compose up -d app
```

### æ­¥é©Ÿ 2: é©—è­‰ç’°å¢ƒè®Šé‡

```bash
# æª¢æŸ¥å®¹å™¨å…§ç’°å¢ƒè®Šé‡
docker exec jyt-gas-app sh -c "printenv | grep GLM_"

# é æœŸè¼¸å‡ºæ‡‰è©²æœ‰å¯¦éš›å€¼ï¼ˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰
```

### æ­¥é©Ÿ 3: æª¢æŸ¥æ‡‰ç”¨æ—¥èªŒ

```bash
# æŸ¥çœ‹ AI Provider åˆå§‹åŒ–æ—¥èªŒ
docker logs --tail 100 jyt-gas-app | grep -i "ai\|glm\|provider\|åˆå§‹åŒ–"
```

**é æœŸè¼¸å‡º**ï¼š
```
[çµ±ä¸€ AI æä¾›å•†] å·²åˆå§‹åŒ– GLM å•†æ¥­ç‰ˆ (å¢å¼·): å¤šå€‹ Keys=3
[å¤š Key GLM Provider] å·²åˆå§‹åŒ–ï¼Œå…± 3 å€‹ Key
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### Next.js ç’°å¢ƒè®Šé‡è™•ç†

Next.js åœ¨**æ§‹å»ºæ™‚**æœƒå°‡ä»¥ `NEXT_PUBLIC_` é–‹é ­çš„ç’°å¢ƒè®Šé‡å…§åµŒåˆ°å®¢æˆ¶ç«¯ä»£ç¢¼ä¸­ã€‚

ä½†æ˜¯ï¼Œ**æœå‹™å™¨ç«¯ç’°å¢ƒè®Šé‡**ï¼ˆå¦‚ `GLM_API_KEYS`ï¼‰åœ¨**é‹è¡Œæ™‚**å¾ `process.env` è®€å–ã€‚

**é€™æ„å‘³è‘—**ï¼š
- âœ… æœå‹™å™¨ç«¯ç’°å¢ƒè®Šé‡ï¼ˆå¦‚ `GLM_API_KEYS`ï¼‰å¯ä»¥åœ¨é‹è¡Œæ™‚é€šé `env_file` å‚³é
- âœ… ä¸éœ€è¦é‡æ–°æ§‹å»º Docker æ˜ åƒ
- âœ… åªéœ€è¦é‡æ–°å‰µå»ºå®¹å™¨å³å¯

### Docker Compose ç’°å¢ƒè®Šé‡å„ªå…ˆç´š

1. **`environment` ä¸­çš„é¡¯å¼è¨­ç½®**ï¼ˆæœ€é«˜å„ªå…ˆç´šï¼‰
2. **`environment` ä¸­çš„è®Šé‡å¼•ç”¨**ï¼ˆå¦‚ `${VAR:-default}`ï¼‰
3. **`env_file` ä¸­çš„é…ç½®**ï¼ˆè¼ƒä½å„ªå…ˆç´šï¼‰
4. **Shell ç’°å¢ƒè®Šé‡**ï¼ˆæœ€ä½å„ªå…ˆç´šï¼‰

**ç•¶å‰é…ç½®**ï¼š
- âœ… å·²ç§»é™¤ `environment` ä¸­å° `GLM_API_KEYS` å’Œ `GLM_API_KEY` çš„è¨­ç½®
- âœ… ä½¿ç”¨ `env_file` å¾ `.env.docker` è®€å–
- âœ… å…¶ä»– GLM é…ç½®ï¼ˆå¦‚ `GLM_MODEL`ï¼‰ä¿ç•™åœ¨ `environment` ä¸­

---

## ğŸ¯ é©—è­‰æª¢æŸ¥æ¸…å–®

### ä¿®å¾©å‰æª¢æŸ¥
- [ ] `.env.docker` æ–‡ä»¶å­˜åœ¨ä¸”åŒ…å« `GLM_API_KEYS`
- [ ] `docker-compose.yml` ä¸­æœ‰ `env_file` é…ç½®
- [ ] `docker-compose.yml` ä¸­æ²’æœ‰ `GLM_API_KEYS` å’Œ `GLM_API_KEY` çš„ `environment` è¨­ç½®

### ä¿®å¾©å¾Œæª¢æŸ¥
- [ ] å®¹å™¨å·²é‡æ–°å‰µå»ºï¼ˆå•Ÿå‹•æ™‚é–“æ˜¯æœ€è¿‘å¹¾åˆ†é˜ï¼‰
- [ ] å®¹å™¨å…§ç’°å¢ƒè®Šé‡æœ‰å¯¦éš›å€¼ï¼ˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰
- [ ] æ‡‰ç”¨æ—¥èªŒé¡¯ç¤º AI Provider å·²åˆå§‹åŒ–
- [ ] API è«‹æ±‚é¡¯ç¤º `Available: true`
- [ ] AI éŸ¿æ‡‰æ˜¯å¯¦éš›çš„ API éŸ¿æ‡‰ï¼ˆä¸æ˜¯æœ¬åœ°å›é€€ï¼‰

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1: ç’°å¢ƒè®Šé‡ä»ç„¶ç‚ºç©º

**å¯èƒ½åŸå› **ï¼š
1. å®¹å™¨æœªé‡æ–°å‰µå»º
2. `.env.docker` æ–‡ä»¶æ ¼å¼éŒ¯èª¤ï¼ˆæœ‰å‰å°ç©ºæ ¼ã€å¼•è™Ÿç­‰ï¼‰
3. æ–‡ä»¶è·¯å¾‘ä¸æ­£ç¢º

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# 1. ç¢ºèªæ–‡ä»¶æ ¼å¼
cat .env.docker | grep GLM_API_KEYS
# æ‡‰è©²çœ‹åˆ°ï¼šGLM_API_KEYS=valueï¼ˆæ²’æœ‰å‰å°ç©ºæ ¼ï¼Œæ²’æœ‰å¼•è™Ÿï¼‰

# 2. å¼·åˆ¶é‡æ–°å‰µå»ºå®¹å™¨
docker-compose up -d --force-recreate app

# 3. æª¢æŸ¥ç’°å¢ƒè®Šé‡
docker exec jyt-gas-app sh -c "printenv | grep GLM_"
```

### å•é¡Œ 2: å®¹å™¨é‡æ–°å‰µå»ºå¾Œç’°å¢ƒè®Šé‡ä»ç„¶ç‚ºç©º

**å¯èƒ½åŸå› **ï¼š
1. `.env.docker` æ–‡ä»¶ä¸­æœ‰æ ¼å¼å•é¡Œ
2. Docker Compose ç‰ˆæœ¬å•é¡Œ
3. æ–‡ä»¶ç·¨ç¢¼å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# 1. æª¢æŸ¥æ–‡ä»¶ç·¨ç¢¼ï¼ˆæ‡‰è©²æ˜¯ UTF-8ï¼Œæ²’æœ‰ BOMï¼‰
file .env.docker

# 2. æª¢æŸ¥æ–‡ä»¶æ ¼å¼
cat .env.docker | grep -E "^GLM_API_KEYS|^GLM_API_KEY"

# 3. æ¸¬è©¦ Docker Compose é…ç½®
docker-compose config | grep GLM_API_KEYS
```

### å•é¡Œ 3: ç’°å¢ƒè®Šé‡æœ‰å€¼ä½†æ‡‰ç”¨ä»é¡¯ç¤ºä¸å¯ç”¨

**å¯èƒ½åŸå› **ï¼š
1. æ‡‰ç”¨æœªé‡æ–°åˆå§‹åŒ–
2. ç’°å¢ƒè®Šé‡æ ¼å¼å•é¡Œï¼ˆå¤šé¤˜ç©ºæ ¼ã€æ›è¡Œç¬¦ç­‰ï¼‰

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# 1. æª¢æŸ¥ç’°å¢ƒè®Šé‡æ ¼å¼
docker exec jyt-gas-app sh -c "echo \$GLM_API_KEYS | wc -c"
# æ‡‰è©² > 50ï¼ˆä¸æ˜¯ 2ï¼‰

# 2. é‡å•Ÿæ‡‰ç”¨
docker-compose restart app

# 3. æª¢æŸ¥æ‡‰ç”¨æ—¥èªŒ
docker logs --tail 50 jyt-gas-app | grep -i "åˆå§‹åŒ–"
```

---

## ğŸ“ ç›¸é—œæ–‡ä»¶

- `docker-compose.yml` - Docker Compose é…ç½®ï¼ˆå·²ä¿®å¾©ï¼‰
- `.env.docker` - ç’°å¢ƒè®Šé‡æ–‡ä»¶ï¼ˆåŒ…å« API Keysï¼‰
- `src/lib/ai-provider-unified.ts` - AI Provider åˆå§‹åŒ–é‚è¼¯
- `src/app/api/ai/chat/route.ts` - API è·¯ç”±è™•ç†

---

## âœ… ä¿®å¾©ç‹€æ…‹

**ä¿®å¾©æ™‚é–“**ï¼š2025-12-29 09:15

**ä¿®å¾©ç‹€æ…‹**ï¼šâœ… é…ç½®å·²ä¿®å¾©ï¼Œç­‰å¾…å®¹å™¨é‡æ–°å‰µå»º

**ä¸‹ä¸€æ­¥**ï¼šè«‹åŸ·è¡Œ `docker-compose up -d --force-recreate app` é‡æ–°å‰µå»ºå®¹å™¨ã€‚
