# ğŸ¯ 521 éŒ¯èª¤æœ€çµ‚è§£æ±ºæ–¹æ¡ˆ

## âœ… è¨ºæ–·çµæœ

æ‰€æœ‰é…ç½®éƒ½æ­£ç¢ºï¼š
- âœ… Tunnel é€£æ¥æ­£å¸¸ï¼ˆ4 å€‹é€£æ¥é»ï¼‰
- âœ… Nginx åˆ° App é€£æ¥æ­£å¸¸
- âœ… é…ç½®æ­£ç¢ºï¼š`http://nginx:80`
- âœ… æ‰€æœ‰å®¹å™¨åœ¨åŒä¸€ç¶²çµ¡

## ğŸ”§ è§£æ±ºæ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šæ¸…é™¤ Cloudflare ç·©å­˜

1. è¨ªå•ï¼šhttps://dash.cloudflare.com/
2. é¸æ“‡åŸŸåï¼š`jytian.it.com`
3. é€²å…¥ **Caching** â†’ **Configuration**
4. é»æ“Š **Purge Everything**

### æ­¥é©Ÿ 2ï¼šæª¢æŸ¥ SSL/TLS è¨­ç½®

1. é€²å…¥ **SSL/TLS** è¨­ç½®
2. ç¢ºèªæ¨¡å¼æ˜¯ **Full** æˆ– **Full (strict)**
3. **ä¸è¦ä½¿ç”¨ Flexible æ¨¡å¼**

### æ­¥é©Ÿ 3ï¼šæª¢æŸ¥ DNS è¨­ç½®

1. é€²å…¥ **DNS** è¨­ç½®
2. ç¢ºèª `linebot` çš„è¨˜éŒ„å­˜åœ¨
3. ç¢ºèªä»£ç†ç‹€æ…‹æ˜¯ **å·²ä»£ç†**ï¼ˆæ©™è‰²é›²æœµï¼‰

### æ­¥é©Ÿ 4ï¼šé‡å•Ÿ Tunnel

```powershell
docker compose restart cloudflared
```

### æ­¥é©Ÿ 5ï¼šç­‰å¾…ä¸¦æ¸¬è©¦

ç­‰å¾… **10-15 åˆ†é˜**ï¼Œç„¶å¾Œæ¸¬è©¦ï¼š

```powershell
curl https://linebot.jytian.it.com/api/webhook/line
```

## ğŸ› å¦‚æœé‚„æ˜¯ 521

### æª¢æŸ¥ Cloudflare Dashboard ä¸­çš„å¯¦éš›é…ç½®

1. è¨ªå•ï¼šhttps://one.dash.cloudflare.com/access/tunnels
2. é»æ“Š **`jyt-gas-tunnel`**
3. é»æ“Š **Configure** â†’ **Public Hostname**ï¼ˆæˆ– **Published Application Routes**ï¼‰
4. ç¢ºèªï¼š
   - Hostname: `linebot.jytian.it.com`
   - Service: `http://nginx:80`
   - å¦‚æœ Service ä¸æ˜¯ `http://nginx:80`ï¼Œè«‹ä¿®æ”¹

### æª¢æŸ¥ Tunnel ç‹€æ…‹

åœ¨ Cloudflare Dashboard ä¸­ï¼š
- ç¢ºèª Tunnel ç‹€æ…‹æ˜¯ **Active** æˆ– **Connected**
- å¦‚æœç‹€æ…‹æ˜¯ **Down**ï¼Œå¯èƒ½éœ€è¦é‡æ–°ç²å– Token

## ğŸ“‹ å®Œæ•´æª¢æŸ¥æ¸…å–®

- [ ] Cloudflare ç·©å­˜å·²æ¸…é™¤
- [ ] SSL/TLS æ¨¡å¼æ˜¯ Full
- [ ] DNS è¨˜éŒ„å­˜åœ¨ä¸”å·²ä»£ç†
- [ ] Cloudflare Dashboard ä¸­ Service URL æ˜¯ `http://nginx:80`
- [ ] Tunnel ç‹€æ…‹æ˜¯ Active/Connected
- [ ] ç­‰å¾… 10-15 åˆ†é˜
- [ ] æ‰€æœ‰ Docker æœå‹™é‹è¡Œæ­£å¸¸

## â° æ™‚é–“ç·š

- **0-5 åˆ†é˜**ï¼šé…ç½®æ›´æ–°ä¸­
- **5-10 åˆ†é˜**ï¼šè·¯ç”±åŒæ­¥ä¸­
- **10-15 åˆ†é˜**ï¼šæ‡‰è©²å¯ä»¥æ­£å¸¸è¨ªå•

## ğŸ¯ æˆåŠŸæ¨™èªŒ

ç•¶ä»¥ä¸‹æ¢ä»¶éƒ½æ»¿è¶³æ™‚ï¼Œå°±æˆåŠŸäº†ï¼š

- âœ… å¤–ç¶²è¨ªå•è¿”å› JSON éŸ¿æ‡‰ï¼ˆä¸æ˜¯ 521ï¼‰
- âœ… éŸ¿æ‡‰æ™‚é–“ < 2 ç§’
- âœ… LINE Developers Console é©—è­‰æˆåŠŸ

---

**ç•¶å‰ç‹€æ…‹**ï¼šæ‰€æœ‰é…ç½®æ­£ç¢ºï¼Œä¸»è¦æ˜¯ç­‰å¾… Cloudflare å®Œæˆè·¯ç”±æ›´æ–°ã€‚

