# âœ… Tunnel ç‹€æ…‹è‰¯å¥½ - æœ€çµ‚ç¢ºèª

## ğŸ“Š Tunnel åŸºæœ¬è³‡è¨Š

### ç‹€æ…‹
- **ç‹€æ…‹**: âœ… **è‰¯å¥½**
- **é‹ä½œæ™‚é–“**: 7 åˆ†é˜
- **èªªæ˜**: è‰¯å¥½ç‹€æ…‹è¡¨ç¤ºå·²é€£æ¥ Tunnelï¼Œä¸¦å¯æä¾›æµé‡

### è­˜åˆ¥è³‡è¨Š
- **Tunnel ID**: `8046a360-5a60-45e4-88f9-0bd7b5d4d486`
- **é€£æ¥å™¨ ID**: `72211803-1666-40ac-a878-cdca95b79ba8`
- **ç‰ˆæœ¬**: `2025.11.1`
- **é€£æ¥å™¨é¡å‹**: `cloudflared`

## âœ… é…ç½®ç¢ºèª

### Dashboard é…ç½®
- âœ… **Service**: `http://nginx:80`ï¼ˆæ­£ç¢ºï¼‰
- âœ… **Hostname**: `linebot.jytian.it.com`
- âœ… **é…ç½®ç‰ˆæœ¬**: v9

### Docker æœå‹™
- âœ… **Nginx**: é‹è¡Œä¸­ (healthy)
- âœ… **App**: é‹è¡Œä¸­ (healthy)
- âœ… **Cloudflare Tunnel**: é‹è¡Œä¸­

## ğŸ§ª æ¸¬è©¦çµæœ

### å¤–ç¶²è¨ªå•æ¸¬è©¦
```bash
curl https://linebot.jytian.it.com/api/webhook/line
```

### é æœŸçµæœ
- âœ… **æˆåŠŸ**: è¿”å› JSON éŸ¿æ‡‰ï¼ˆä¸å† 521 éŒ¯èª¤ï¼‰
- âš ï¸ **521 éŒ¯èª¤**: å¯èƒ½æ˜¯ Cloudflare ç·©å­˜å•é¡Œ

## ğŸ’¡ å¦‚æœé‚„æ˜¯ 521 éŒ¯èª¤

### åŸå› åˆ†æ
é›–ç„¶ Tunnel ç‹€æ…‹é¡¯ç¤ºã€Œè‰¯å¥½ã€ï¼Œä½†å¤–ç¶²è¨ªå•å¯èƒ½é‚„æ˜¯ 521ï¼Œé€™é€šå¸¸æ˜¯å› ç‚ºï¼š

1. **Cloudflare ç·©å­˜å•é¡Œ**
   - Cloudflare å¯èƒ½é‚„åœ¨ä½¿ç”¨èˆŠçš„ç·©å­˜é…ç½®
   - éœ€è¦æ¸…é™¤ç·©å­˜

2. **é…ç½®å‚³æ’­å»¶é²**
   - é›–ç„¶é…ç½®å·²æ›´æ–°ï¼Œä½†å…¨çƒç¯€é»éœ€è¦æ™‚é–“åŒæ­¥
   - é€šå¸¸éœ€è¦ 10-15 åˆ†é˜

### è§£æ±ºæ–¹æ¡ˆ

#### æ–¹æ³• 1ï¼šæ¸…é™¤ Cloudflare ç·©å­˜ï¼ˆæ¨è–¦ï¼‰
1. ç™»å…¥ [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. é¸æ“‡åŸŸåï¼š`jytian.it.com`
3. é€²å…¥ï¼š**Caching** > **Configuration**
4. é»æ“Šï¼š**Purge Everything**
5. ç­‰å¾… 1-2 åˆ†é˜å¾Œå†æ¬¡æ¸¬è©¦

#### æ–¹æ³• 2ï¼šç­‰å¾…æ›´é•·æ™‚é–“
- ç­‰å¾… 10-15 åˆ†é˜è®“é…ç½®å®Œå…¨å‚³æ’­
- ç„¶å¾Œå†æ¬¡æ¸¬è©¦

#### æ–¹æ³• 3ï¼šæª¢æŸ¥è·¯ç”±é…ç½®
ç¢ºèª Dashboard ä¸­çš„è·¯ç”±é…ç½®ï¼š
- **Service**: æ‡‰è©²æ˜¯ `http://nginx:80`
- **ä¸æ˜¯**: `http://localhost:80` æˆ– `http://localhost:9999`

## ğŸ” é©—è­‰æ­¥é©Ÿ

### 1. æª¢æŸ¥ Tunnel æ—¥èªŒ
```bash
docker compose logs cloudflared --tail 30
```

æ‡‰è©²çœ‹åˆ°ï¼š
- âœ… `Updated to new configuration ... "service":"http://nginx:80" ... version=9`
- âœ… `Registered tunnel connection ... location=tpe01/nrt01/nrt05`

### 2. æª¢æŸ¥å…§éƒ¨é€£æ¥
```bash
# æ¸¬è©¦ cloudflared èƒ½å¦è¨ªå• nginx
docker compose exec cloudflared wget -qO- http://nginx:80/health
```

### 3. æª¢æŸ¥æœå‹™ç‹€æ…‹
```bash
docker compose ps
```

æ‰€æœ‰æœå‹™æ‡‰è©²éƒ½æ˜¯ `Up` ç‹€æ…‹ã€‚

## ğŸ“‹ å®Œæ•´æ¶æ§‹ç¢ºèª

```
Internet
   â†“
Cloudflare Edge (å…¨çƒç¯€é»)
   â†“
Cloudflare Tunnel (ç‹€æ…‹: è‰¯å¥½ âœ…)
   â†“ http://nginx:80
Nginx (åå‘ä»£ç†)
   â†“ http://app:9999
Next.js App
```

## ğŸ¯ ç¸½çµ

### âœ… å·²å®Œæˆ
1. âœ… Token å·²è¨­ç½®
2. âœ… Dashboard é…ç½®æ­£ç¢ºï¼ˆ`http://nginx:80`ï¼‰
3. âœ… Tunnel ç‹€æ…‹è‰¯å¥½ï¼ˆå·²é€£æ¥ä¸¦å¯æä¾›æµé‡ï¼‰
4. âœ… é…ç½®ç‰ˆæœ¬ v9 å·²ç”Ÿæ•ˆ
5. âœ… æ‰€æœ‰æœå‹™é‹è¡Œæ­£å¸¸

### â³ å¦‚æœé‚„æ˜¯ 521
- âš ï¸ å¯èƒ½æ˜¯ Cloudflare ç·©å­˜å•é¡Œ
- ğŸ’¡ å»ºè­°æ¸…é™¤ç·©å­˜æˆ–ç­‰å¾…æ›´é•·æ™‚é–“

### ğŸ‰ ç‹€æ…‹
**Tunnel å·²æ­£å¸¸é€£æ¥ï¼Œé…ç½®å®Œå…¨æ­£ç¢ºï¼å¦‚æœé‚„æ˜¯ 521ï¼Œè«‹æ¸…é™¤ Cloudflare ç·©å­˜ã€‚**

---

**æœ€å¾Œæ›´æ–°**: 2025-12-28
**Tunnel ç‹€æ…‹**: âœ… è‰¯å¥½
**é‹ä½œæ™‚é–“**: 7 åˆ†é˜

