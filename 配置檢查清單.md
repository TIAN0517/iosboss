# âœ… é…ç½®æª¢æŸ¥æ¸…å–®

## ğŸ“Š ç•¶å‰ç‹€æ…‹

### âœ… å·²å®Œæˆçš„é…ç½®

1. **Cloudflare Tunnel å‰µå»º**
   - âœ… Tunnel å·²å‰µå»ºï¼š`jyt-gas-tunnel`
   - âœ… Tunnel IDï¼š`db89d429-b35d-4232-9e53-244ed2890713`
   - âœ… Public Hostname å·²é…ç½®ï¼š`https://linebot.jytian.it.com` â†’ `http://nginx:80`

2. **Docker æœå‹™**
   - âœ… App æœå‹™ï¼šé‹è¡Œä¸­ï¼ˆå¥åº·ï¼‰
   - âœ… Nginx æœå‹™ï¼šé‹è¡Œä¸­ï¼ˆå¥åº·ï¼‰
   - âœ… PostgreSQL æœå‹™ï¼šé‹è¡Œä¸­ï¼ˆå¥åº·ï¼‰

3. **API Token**
   - âœ… Cloudflare API Token å·²é©—è­‰
   - âœ… æ¬Šé™å·²é…ç½®ï¼ˆåŒ…æ‹¬ Cloudflare Tunnel ç·¨è¼¯æ¬Šé™ï¼‰

### âŒ é‚„éœ€è¦é…ç½®çš„é …ç›®

1. **Cloudflare Tunnel Token** âš ï¸ **æœ€é‡è¦**
   - âŒ `CF_TUNNEL_TOKEN` æœªè¨­ç½®ï¼ˆ`.env` æ–‡ä»¶ä¸­ç‚ºç©ºï¼‰
   - âŒ Tunnel ç‹€æ…‹ï¼š`down`ï¼ˆéœ€è¦ Token æ‰èƒ½é€£æ¥ï¼‰
   - âŒ å¤–ç¶²è¨ªå•ï¼š521 éŒ¯èª¤ï¼ˆå› ç‚º Tunnel æœªé€£æ¥ï¼‰

## ğŸ¯ é‚„éœ€è¦åšçš„äº‹æƒ…

### æ­¥é©Ÿ 1ï¼šç²å– Cloudflare Tunnel Tokenï¼ˆå¿…é ˆï¼‰

**é‡è¦èªªæ˜**ï¼š
- æ‚¨åœ–ç‰‡ä¸­é¡¯ç¤ºçš„æ˜¯å‰µå»º **API Token** çš„é é¢
- æˆ‘å€‘éœ€è¦çš„æ˜¯ **Tunnel Token**ï¼Œé€™æ˜¯ä¸åŒçš„æ±è¥¿
- Tunnel Token éœ€è¦å¾ **Tunnel è©³æƒ…é é¢** ç²å–ï¼Œä¸æ˜¯å¾ API Token é é¢

**ç²å–æ­¥é©Ÿ**ï¼š

1. **è¨ªå• Tunnel é é¢**ï¼ˆä¸æ˜¯ API Token é é¢ï¼‰
   - è¨ªå•ï¼šhttps://one.dash.cloudflare.com/
   - é»æ“Šå·¦å´èœå–® **Zero Trust** â†’ **Access** â†’ **Tunnels**
   - æˆ–ç›´æ¥è¨ªå•ï¼šhttps://one.dash.cloudflare.com/access/tunnels

2. **æ‰¾åˆ°æ‚¨çš„ Tunnel**
   - åœ¨ Tunnels åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ°ï¼š`jyt-gas-tunnel`
   - **é»æ“Š Tunnel åç¨±**é€²å…¥è©³æƒ…é é¢ï¼ˆä¸æ˜¯ç·¨è¼¯ API Tokenï¼‰

3. **ç²å– Token**
   - åœ¨ Tunnel è©³æƒ…é é¢ï¼Œæ‰¾åˆ° **Token** æŒ‰éˆ•
   - é»æ“Š **Token** æŒ‰éˆ•
   - è¤‡è£½å®Œæ•´çš„ Tokenï¼ˆé€šå¸¸ä»¥ `eyJ` é–‹é ­ï¼Œå¾ˆé•·ï¼‰

### æ­¥é©Ÿ 2ï¼šè¨­ç½® Token åˆ° .env æ–‡ä»¶

ç²å– Token å¾Œï¼Œé‹è¡Œï¼š

```powershell
.\set-tunnel-token.ps1 -Token "your_copied_token_here"
```

æˆ–æ‰‹å‹•ç·¨è¼¯ `.env` æ–‡ä»¶ç¬¬ 164 è¡Œï¼š
```env
CF_TUNNEL_TOKEN="your_copied_token_here"
```

### æ­¥é©Ÿ 3ï¼šå•Ÿå‹• Cloudflare Tunnel

```powershell
docker compose up -d cloudflared
```

### æ­¥é©Ÿ 4ï¼šé©—è­‰é…ç½®

```powershell
# æª¢æŸ¥ç‹€æ…‹
docker compose ps cloudflared

# æŸ¥çœ‹æ—¥èªŒ
docker compose logs cloudflared --tail 50

# æ¸¬è©¦å¤–ç¶²è¨ªå•
curl https://linebot.jytian.it.com/api/webhook/line
```

## ğŸ“ é…ç½®å°æ¯”

| é …ç›® | API Tokenï¼ˆæ‚¨åœ–ç‰‡ä¸­çš„ï¼‰ | Tunnel Tokenï¼ˆæˆ‘å€‘éœ€è¦çš„ï¼‰ |
|------|----------------------|------------------------|
| ç”¨é€” | ç”¨æ–¼ Cloudflare API èª¿ç”¨ | ç”¨æ–¼ Cloudflare Tunnel é€£æ¥ |
| ç²å–ä½ç½® | API Token ç®¡ç†é é¢ | Tunnel è©³æƒ…é é¢ |
| æ ¼å¼ | é€šå¸¸ä»¥å­—æ¯æ•¸å­—é–‹é ­ | é€šå¸¸ä»¥ `eyJ` é–‹é ­ï¼ˆBase64ï¼‰ |
| ç•¶å‰ç‹€æ…‹ | âœ… å·²é…ç½® | âŒ æœªè¨­ç½® |

## ğŸ¯ å¿«é€Ÿæ“ä½œæŒ‡å—

### å¦‚æœæ‚¨åœ¨ Cloudflare Dashboardï¼š

1. **ä¸è¦**åœ¨ API Token é é¢åœç•™
2. **é»æ“Šå·¦å´èœå–®** â†’ **Zero Trust** â†’ **Access** â†’ **Tunnels**
3. **æ‰¾åˆ°** `jyt-gas-tunnel` ä¸¦é»æ“Šå®ƒ
4. **åœ¨ Tunnel è©³æƒ…é é¢**æ‰¾åˆ° Token æŒ‰éˆ•
5. **è¤‡è£½ Token** ä¸¦è¨­ç½®åˆ° `.env` æ–‡ä»¶

### è¨­ç½® Token å¾Œï¼š

```powershell
# 1. è¨­ç½® Tokenï¼ˆå¦‚æœé‚„æ²’è¨­ç½®ï¼‰
.\set-tunnel-token.ps1 -Token "your_token"

# 2. å•Ÿå‹•æœå‹™
docker compose up -d cloudflared

# 3. æª¢æŸ¥ç‹€æ…‹
docker compose ps cloudflared
docker compose logs cloudflared --tail 50

# 4. æ¸¬è©¦é€£æ¥
curl https://linebot.jytian.it.com/api/webhook/line
```

## âœ… å®Œæˆå¾Œçš„é æœŸç‹€æ…‹

- âœ… `CF_TUNNEL_TOKEN` å·²è¨­ç½®ï¼ˆ`.env` æ–‡ä»¶ï¼‰
- âœ… Cloudflare Tunnel å®¹å™¨é‹è¡Œä¸­
- âœ… Tunnel ç‹€æ…‹ï¼š`active` æˆ– `connected`
- âœ… å¤–ç¶²å¯ä»¥è¨ªå• `https://linebot.jytian.it.com/api/webhook/line`
- âœ… LINE Developers Console é©—è­‰æˆåŠŸ

## ğŸ› å¦‚æœé‡åˆ°å•é¡Œ

### Token ç„¡æ•ˆ
- ç¢ºèªå¾æ­£ç¢ºçš„é é¢ç²å–ï¼ˆTunnel è©³æƒ…é ï¼Œä¸æ˜¯ API Token é ï¼‰
- ç¢ºèªè¤‡è£½äº†å®Œæ•´çš„ Token
- ç¢ºèªæ²’æœ‰å¤šé¤˜çš„ç©ºæ ¼

### å®¹å™¨ç„¡æ³•å•Ÿå‹•
```powershell
# æª¢æŸ¥æ—¥èªŒ
docker compose logs cloudflared

# æª¢æŸ¥ .env æ–‡ä»¶æ ¼å¼
Get-Content .env | Select-String "CF_TUNNEL_TOKEN"
```

---

**ç¸½çµ**ï¼šåªéœ€è¦ç²å–ä¸¦è¨­ç½® **Cloudflare Tunnel Token**ï¼Œå…¶ä»–é…ç½®éƒ½å·²å®Œæˆï¼

