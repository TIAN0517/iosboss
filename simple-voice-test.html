<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç°¡å–®èªéŸ³æ¸¬è©¦</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover { background: #0056b3; }
    button:disabled { background: #ccc; }
    .result {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      min-height: 50px;
    }
    .status {
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”Š ç°¡å–®èªéŸ³æ¸¬è©¦</h1>

    <div id="status" class="status info">
      æº–å‚™å°±ç·’ï¼Œè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ¸¬è©¦
    </div>

    <div>
      <button onclick="test1()">1ï¸âƒ£ æ¸¬è©¦ï¼šç›´æ¥æ’­æ”¾èªéŸ³</button>
      <button onclick="test2()">2ï¸âƒ£ æ¸¬è©¦ï¼šèªéŸ³è­˜åˆ¥</button>
      <button onclick="test3()">3ï¸âƒ£ æ¸¬è©¦ï¼šAI å°è©±</button>
    </div>

    <div id="result" class="result">
      çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡...
    </div>

    <div style="margin-top: 30px; padding: 15px; background: #fff3cd; border-radius: 8px;">
      <strong>ğŸ’¡ ä½¿ç”¨èªªæ˜ï¼š</strong><br>
      1. å…ˆæ¸¬è©¦ã€Œç›´æ¥æ’­æ”¾èªéŸ³ã€ï¼Œç¢ºèªæ‚¨çš„é›»è…¦/æ‰‹æ©Ÿèƒ½ç™¼è²<br>
      2. å†æ¸¬è©¦ã€ŒèªéŸ³è­˜åˆ¥ã€ï¼Œç¢ºèªéº¥å…‹é¢¨æ­£å¸¸<br>
      3. æœ€å¾Œæ¸¬è©¦ã€ŒAI å°è©±ã€ï¼Œå®Œæ•´é«”é©—èªéŸ³åŠ©æ‰‹
    </div>

    <script>
      const resultDiv = document.getElementById('result');
      const statusDiv = document.getElementById('status');

      function showStatus(message, type = 'info') {
        statusDiv.textContent = message;
        statusDiv.className = `status ${type}`;
      }

      function showResult(message) {
        resultDiv.textContent = message;
      }

      // æ¸¬è©¦ 1: ç›´æ¥æ’­æ”¾èªéŸ³
      function test1() {
        showStatus('æ­£åœ¨æ¸¬è©¦èªéŸ³æ’­æ”¾...', 'info');
        showResult('æº–å‚™æ’­æ”¾...');

        if ('speechSynthesis' in window) {
          const utterance = new SpeechSynthesisUtterance('ä½ å¥½ï¼Œé€™æ˜¯èªéŸ³æ¸¬è©¦ã€‚è«‹ç¢ºèªæ‚¨è½åˆ°è²éŸ³ã€‚');
          utterance.lang = 'zh-TW';
          utterance.rate = 1.0;
          utterance.volume = 1.0;

          utterance.onstart = () => {
            showResult('ğŸ”Š æ­£åœ¨æ’­æ”¾... è«‹è½ï¼');
          };

          utterance.onend = () => {
            showResult('âœ… æ’­æ”¾å®Œæˆï¼æ‚¨è½åˆ°è²éŸ³äº†å—ï¼Ÿ');
            showStatus('æ¸¬è©¦å®Œæˆ', 'success');
          };

          utterance.onerror = (e) => {
            showResult('âŒ æ’­æ”¾å¤±æ•—: ' + e.error);
            showStatus('æ’­æ”¾å¤±æ•—', 'error');
            console.error('Error:', e);
          };

          speechSynthesis.speak(utterance);
        } else {
          showResult('âŒ æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­æ”¾');
          showStatus('ä¸æ”¯æ´èªéŸ³åˆæˆ', 'error');
        }
      }

      // æ¸¬è©¦ 2: èªéŸ³è­˜åˆ¥
      function test2() {
        showStatus('æ­£åœ¨æ¸¬è©¦èªéŸ³è­˜åˆ¥...', 'info');
        showResult('æº–å‚™è­˜åˆ¥...');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (!SpeechRecognition) {
          showResult('âŒ æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è­˜åˆ¥ã€‚è«‹ä½¿ç”¨ Chrome æˆ– Edgeã€‚');
          showStatus('ä¸æ”¯æ´èªéŸ³è­˜åˆ¥', 'error');
          return;
        }

        const recognition = new SpeechRecognition();
        recognition.lang = 'zh-TW';
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onstart = () => {
          showResult('ğŸ¤ è«‹èªªè©±ï¼ˆä¾‹å¦‚ï¼šä½ å¥½ï¼‰...');
        };

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          showResult('âœ… è­˜åˆ¥åˆ°: "' + transcript + '"');
          showStatus('è­˜åˆ¥æˆåŠŸ', 'success');

          // æ’­æ”¾è­˜åˆ¥çš„å…§å®¹
          const utterance = new SpeechSynthesisUtterance('æ‚¨å‰›æ‰èªªï¼š' + transcript);
          utterance.lang = 'zh-TW';
          speechSynthesis.speak(utterance);
        };

        recognition.onerror = (event) => {
          showResult('âŒ è­˜åˆ¥å¤±æ•—: ' + event.error);
          showStatus('è­˜åˆ¥å¤±æ•—', 'error');
        };

        recognition.onend = () => {
          if (resultDiv.textContent.includes('è­˜åˆ¥åˆ°')) {
            showStatus('æ¸¬è©¦å®Œæˆ', 'success');
          }
        };

        recognition.start();
      }

      // æ¸¬è©¦ 3: AI å°è©±
      async function test3() {
        showStatus('æ­£åœ¨æ¸¬è©¦ AI å°è©±...', 'info');
        showResult('æº–å‚™é€£æ¥ AI...');

        try {
          const response = await fetch('http://localhost:9999/api/ai/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              message: 'ä½ å¥½',
              conversationHistory: [],
              stream: false
            })
          });

          if (response.ok) {
            const data = await response.json();
            showResult('ğŸ¤– AI å›æ‡‰: ' + (data.content || 'ç„¡'));

            // æ’­æ”¾ AI å›æ‡‰
            if ('speechSynthesis' in window && data.content) {
              const utterance = new SpeechSynthesisUtterance(data.content);
              utterance.lang = 'zh-TW';
              utterance.volume = 1.0;

              utterance.onstart = () => {
                showResult('ğŸ”Š æ­£åœ¨æ’­æ”¾ AI å›æ‡‰...');
              };

              utterance.onend = () => {
                showStatus('æ¸¬è©¦å®Œæˆï¼', 'success');
              };

              speechSynthesis.speak(utterance);
            } else {
              showStatus('æ¸¬è©¦å®Œæˆï¼ˆä½†ç„¡èªéŸ³æ’­æ”¾ï¼‰', 'warning');
            }
          } else {
            showResult('âŒ API éŒ¯èª¤: ' + response.status);
            showStatus('API éŒ¯èª¤', 'error');
          }
        } catch (error) {
          showResult('âŒ é€£æ¥å¤±æ•—: ' + error.message);
          showStatus('é€£æ¥å¤±æ•—', 'error');
        }
      }
    </script>
</body>
</html>
