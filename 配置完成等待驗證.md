# âœ… Cloudflare Tunnel é…ç½®å®Œæˆ

## ğŸ‰ å·²å®Œæˆçš„é…ç½®

1. âœ… **Token å·²è¨­ç½®**
   - Cloudflare Tunnel Token å·²æˆåŠŸè¨­ç½®åˆ° `.env` æ–‡ä»¶
   - Token æ ¼å¼æ­£ç¢ºï¼ˆ184 å­—ç¬¦ï¼Œä»¥ `eyJ` é–‹é ­ï¼‰

2. âœ… **Cloudflare Tunnel å·²å•Ÿå‹•**
   - å®¹å™¨ç‹€æ…‹ï¼šé‹è¡Œä¸­
   - é€£æ¥ç‹€æ…‹ï¼šå·²è¨»å†Š 4 å€‹é€£æ¥é»
   - é…ç½®å·²æ›´æ–°ï¼š`linebot.jytian.it.com` â†’ `http://nginx:80`

3. âœ… **Docker æœå‹™æ­£å¸¸**
   - Appï¼šé‹è¡Œä¸­ï¼ˆå¥åº·ï¼‰
   - Nginxï¼šé‹è¡Œä¸­ï¼ˆå¥åº·ï¼‰
   - PostgreSQLï¼šé‹è¡Œä¸­ï¼ˆå¥åº·ï¼‰
   - Cloudflare Tunnelï¼šé‹è¡Œä¸­

## â³ ç•¶å‰ç‹€æ…‹

### å¤–ç¶²è¨ªå•ï¼š521 éŒ¯èª¤ï¼ˆæš«æ™‚ï¼‰

é€™æ˜¯**æ­£å¸¸çš„**ï¼Œå› ç‚ºï¼š
- Cloudflare éœ€è¦æ™‚é–“æ›´æ–°è·¯ç”±é…ç½®ï¼ˆé€šå¸¸ 2-5 åˆ†é˜ï¼‰
- DNS å‚³æ’­éœ€è¦æ™‚é–“
- Tunnel é€£æ¥å‰›å»ºç«‹ï¼Œéœ€è¦ä¸€äº›æ™‚é–“åŒæ­¥

## ğŸ§ª é©—è­‰æ­¥é©Ÿ

### 1. ç­‰å¾… 2-5 åˆ†é˜

è®“ Cloudflare å®Œæˆè·¯ç”±æ›´æ–°ã€‚

### 2. æ¸¬è©¦å¤–ç¶²è¨ªå•

```powershell
curl https://linebot.jytian.it.com/api/webhook/line
```

**é æœŸçµæœ**ï¼š
```json
{
  "status": "ready",
  "message": "LINE Bot Webhook is ready (Humanized Conversational AI)",
  ...
}
```

### 3. åœ¨ LINE Developers Console é©—è­‰

1. è¨ªå•ï¼šhttps://developers.line.biz/console/
2. é¸æ“‡æ‚¨çš„ LINE Bot
3. é€²å…¥ **Messaging API** æ¨™ç±¤
4. é»æ“Š **Verify** æŒ‰éˆ•
5. æ‡‰è©²é¡¯ç¤ºï¼š**âœ… Webhook URL is valid**

## ğŸ” æª¢æŸ¥å‘½ä»¤

### æª¢æŸ¥æœå‹™ç‹€æ…‹
```powershell
docker compose ps
```

### æŸ¥çœ‹ Tunnel æ—¥èªŒ
```powershell
docker compose logs cloudflared --tail 50
```

### æ¸¬è©¦æœ¬åœ°æœå‹™
```powershell
curl http://localhost:9999/api/webhook/line
```

### æ¸¬è©¦å¤–ç¶²è¨ªå•
```powershell
curl https://linebot.jytian.it.com/api/webhook/line
```

## ğŸ› å¦‚æœ 5 åˆ†é˜å¾Œé‚„æ˜¯ 521

### æª¢æŸ¥ 1ï¼šç¢ºèª Tunnel é€£æ¥
```powershell
docker compose logs cloudflared | Select-String "Registered"
```

æ‡‰è©²çœ‹åˆ°å¤šå€‹ "Registered tunnel connection" æ¶ˆæ¯ã€‚

### æª¢æŸ¥ 2ï¼šç¢ºèªé…ç½®
```powershell
docker compose logs cloudflared | Select-String "hostname|ingress"
```

æ‡‰è©²çœ‹åˆ° `linebot.jytian.it.com` çš„é…ç½®ã€‚

### æª¢æŸ¥ 3ï¼šé‡å•Ÿ Tunnel
```powershell
docker compose restart cloudflared
docker compose logs cloudflared --tail 20
```

### æª¢æŸ¥ 4ï¼šé©—è­‰ DNS
```powershell
nslookup linebot.jytian.it.com
```

æ‡‰è©²è¿”å› Cloudflare çš„ IP åœ°å€ã€‚

## âœ… æˆåŠŸæ¨™èªŒ

ç•¶ä»¥ä¸‹æ¢ä»¶éƒ½æ»¿è¶³æ™‚ï¼Œé…ç½®å°±å®Œå…¨æˆåŠŸäº†ï¼š

- âœ… Tunnel å®¹å™¨é‹è¡Œä¸­
- âœ… æ—¥èªŒé¡¯ç¤º "Registered tunnel connection"
- âœ… å¤–ç¶²è¨ªå•è¿”å› JSON éŸ¿æ‡‰ï¼ˆä¸æ˜¯ 521ï¼‰
- âœ… LINE Developers Console é©—è­‰æˆåŠŸ

## ğŸ“ é…ç½®æ‘˜è¦

- **Tunnel åç¨±**ï¼š`jyt-gas-tunnel`
- **Tunnel ID**ï¼š`db89d429-b35d-4232-9e53-244ed2890713`
- **Public Hostname**ï¼š`https://linebot.jytian.it.com`
- **Service URL**ï¼š`http://nginx:80`
- **Token ç‹€æ…‹**ï¼šå·²è¨­ç½® âœ…
- **é€£æ¥ç‹€æ…‹**ï¼šå·²é€£æ¥ âœ…

---

**ä¸‹ä¸€æ­¥**ï¼šç­‰å¾… 2-5 åˆ†é˜ï¼Œç„¶å¾Œæ¸¬è©¦å¤–ç¶²è¨ªå•ã€‚å¦‚æœé‚„æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ä¸Šé¢çš„æ•…éšœæ’é™¤æ­¥é©Ÿã€‚

