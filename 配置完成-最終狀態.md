# âœ… Cloudflare Tunnel é…ç½®å®Œæˆ - æœ€çµ‚ç‹€æ…‹

## ğŸ‰ é…ç½®å·²æ­£ç¢ºï¼

### âœ… å·²å®Œæˆ
1. **Token è¨­ç½®**ï¼šå·²è¨­ç½®åˆ° `.env`
2. **Dashboard é…ç½®**ï¼šService å·²æ”¹ç‚º `http://nginx:80` âœ…
3. **é…ç½®æ›´æ–°**ï¼šç‰ˆæœ¬ 9 å·²ç”Ÿæ•ˆ
4. **æœå‹™ç‹€æ…‹**ï¼šæ‰€æœ‰æœå‹™é‹è¡Œæ­£å¸¸

### ğŸ“Š é…ç½®æ­·å²
- **ç‰ˆæœ¬ 7**ï¼š`http://localhost:9999` âŒ
- **ç‰ˆæœ¬ 8**ï¼š`http://localhost:80` âŒ
- **ç‰ˆæœ¬ 9**ï¼š`http://nginx:80` âœ… **æ­£ç¢ºï¼**

## â³ ç•¶å‰ç‹€æ…‹

### é…ç½®ç‹€æ…‹
- âœ… Dashboard é…ç½®ï¼šæ­£ç¢º
- âœ… Docker é…ç½®ï¼šæ­£ç¢º
- âœ… æœå‹™å¥åº·ï¼šå…¨éƒ¨æ­£å¸¸
- â³ å¤–ç¶²è¨ªå•ï¼šç­‰å¾… Cloudflare æ›´æ–°ï¼ˆ5-10 åˆ†é˜ï¼‰

### æœå‹™ç‹€æ…‹
```
âœ… Nginx:     é‹è¡Œä¸­ (healthy)
âœ… App:       é‹è¡Œä¸­ (healthy)
âœ… Cloudflare: é‹è¡Œä¸­
```

## ğŸ§ª æ¸¬è©¦

### æ¸¬è©¦å‘½ä»¤
```bash
curl https://linebot.jytian.it.com/api/webhook/line
```

### é æœŸçµæœ
- âœ… æˆåŠŸï¼šè¿”å› JSON éŸ¿æ‡‰ï¼ˆä¸å† 521 éŒ¯èª¤ï¼‰
- â³ ç­‰å¾…ä¸­ï¼šé‚„æ˜¯ 521ï¼ˆæ­£å¸¸ï¼Œéœ€è¦ç­‰å¾…ï¼‰

## ğŸ’¡ å¦‚æœé‚„æ˜¯ 521

### 1. ç­‰å¾…æ›´é•·æ™‚é–“
- Cloudflare é…ç½®æ›´æ–°å¯èƒ½éœ€è¦ 10-15 åˆ†é˜
- è«‹è€å¿ƒç­‰å¾…

### 2. æ¸…é™¤ç·©å­˜ï¼ˆå¯é¸ï¼‰
åœ¨ Cloudflare Dashboard ä¸­ï¼š
1. é€²å…¥ **Caching** > **Configuration**
2. é»æ“Š **Purge Everything**
3. ç­‰å¾…å¹¾åˆ†é˜å¾Œå†æ¬¡æ¸¬è©¦

### 3. æª¢æŸ¥æ—¥èªŒ
```bash
# æŸ¥çœ‹å¯¦æ™‚æ—¥èªŒ
docker compose logs -f cloudflared

# æŸ¥çœ‹é…ç½®æ›´æ–°
docker compose logs cloudflared | Select-String "Updated to new configuration"
```

## ğŸ“‹ æœ€çµ‚é…ç½®

### Dashboard é…ç½®
```
Hostname: linebot.jytian.it.com
Service:  http://nginx:80 âœ…
Path:     * (æ‰€æœ‰è·¯å¾‘)
```

### Docker ç¶²çµ¡æ¶æ§‹
```
cloudflared â†’ http://nginx:80 â†’ nginx â†’ http://app:9999 â†’ Next.js
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. â³ **ç­‰å¾… 5-10 åˆ†é˜**è®“ Cloudflare æ›´æ–°
2. ğŸ§ª **æ¸¬è©¦å¤–ç¶²è¨ªå•**
3. âœ… **ç¢ºèªä¸å†å‡ºç¾ 521 éŒ¯èª¤**
4. ğŸ‰ **é…ç½®å®Œæˆï¼**

## ğŸ“ é‡è¦æç¤º

- âœ… é…ç½®å·²å®Œå…¨æ­£ç¢º
- âœ… æ‰€æœ‰æœå‹™é‹è¡Œæ­£å¸¸
- â³ åªéœ€è¦ç­‰å¾… Cloudflare æ›´æ–°å³å¯
- ğŸ’¡ å¦‚æœ 10 åˆ†é˜å¾Œé‚„æ˜¯ 521ï¼Œå¯ä»¥å˜—è©¦æ¸…é™¤ç·©å­˜

---

**é…ç½®å®Œæˆæ™‚é–“**: 2025-12-28 12:40
**é…ç½®ç‰ˆæœ¬**: v9
**ç‹€æ…‹**: âœ… é…ç½®æ­£ç¢ºï¼Œç­‰å¾…ç”Ÿæ•ˆ

