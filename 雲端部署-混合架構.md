# é›²ç«¯éƒ¨ç½² - æ··åˆæ¶æ§‹é…ç½®æŒ‡å—

## ğŸ—ï¸ æ¶æ§‹èªªæ˜

### æ··åˆæ¶æ§‹ï¼ˆæ¨è–¦ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Netlify    â”‚ â”€â”€â”€â–¶ â”‚  Supabase   â”‚ â—€â”€â”€â”€ â”‚  æœ¬åœ°é›»è…¦   â”‚
â”‚ (é›²ç«¯éƒ¨ç½²)   â”‚       â”‚  (é›²ç«¯æ•¸æ“šåº«) â”‚       â”‚ (æœ¬åœ° AI)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                      â”‚
       â”‚                                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åå‘ä»£ç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éƒ¨ç½²åˆ†é…ï¼š**
- âœ… **Netlifyï¼ˆé›²ç«¯ï¼‰**ï¼š
  - LINE Bot Webhook æ¥æ”¶
  - æ•¸æ“šåº«æ“ä½œï¼ˆSupabaseï¼‰
  - Web æ‡‰ç”¨ç•Œé¢
  - API è·¯ç”±

- âœ… **æœ¬åœ°é›»è…¦**ï¼š
  - AI åŠŸèƒ½ï¼ˆOllamaï¼‰
  - é€šé Cloudflare Tunnel æš´éœ²çµ¦é›²ç«¯
  - é›²ç«¯é€šéåå‘ä»£ç†è¨ªå•æœ¬åœ° AI

---

## ğŸ”§ æœ¬åœ°é…ç½®

### æ­¥é©Ÿ 1ï¼šè¨­ç½® Cloudflare Tunnelï¼ˆåå‘ä»£ç†ï¼‰

#### æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Cloudflare Tunnelï¼ˆæ¨è–¦ï¼‰

1. **å®‰è£ Cloudflare Tunnel**
```bash
# ä¸‹è¼‰ cloudflared
# Windows: https://github.com/cloudflare/cloudflared/releases/latest

# å‰µå»º Tunnel
cloudflared tunnel create my-ai-tunnel

# é…ç½® Tunnel
cloudflared tunnel route dns my-ai-tunnel ai.yourdomain.com

# é‹è¡Œ Tunnel
cloudflared tunnel run my-ai-tunnel
```

2. **é…ç½® Tunnel è¦å‰‡**ï¼ˆ`cloudflared.yml`ï¼‰ï¼š
```yaml
tunnel: <tunnel-id>
credentials-file: <path-to-credentials.json>

ingress:
  - hostname: ai.yourdomain.com
    service: http://localhost:11434
  - service: http_status:404
```

#### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ ngrokï¼ˆç°¡å–®å¿«é€Ÿï¼‰

1. **å®‰è£ ngrok**
```bash
# ä¸‹è¼‰ ngrok
# Windows: https://ngrok.com/download

# å‰µå»º Tunnel
ngrok http 11434
```

2. **ç²å¾—å…¬é–‹ URL**
```
Forwarding: https://xxxx-xx-xx-xx.ngrok.io -> http://localhost:11434
```

**è¨˜ä¸‹é€™å€‹ URLï¼**

---

### æ­¥é©Ÿ 2ï¼šé…ç½®æœ¬åœ°ç’°å¢ƒè®Šé‡

å‰µå»º `.env.production` æ–‡ä»¶ï¼š

```bash
# ========================================
# é›²ç«¯éƒ¨ç½²ç’°å¢ƒè®Šé‡ï¼ˆNetlifyï¼‰
# ========================================

# ========================================
# ğŸ”´ å¿…éœ€é…ç½® - æ‡‰ç”¨åŸºæœ¬è¨­ç½®
# ========================================
NODE_ENV=production
NEXT_TELEMETRY_DISABLED=1

# ========================================
# ğŸ”´ å¿…éœ€é…ç½® - æ•¸æ“šåº«é€£æ¥ï¼ˆSupabase é›²ç«¯ï¼‰
# ========================================
# æ›¿æ› [YOUR-PASSWORD] ç‚ºæ‚¨çš„ Supabase å¯†ç¢¼
DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@db.mdmltksbpdyndoisnqhy.supabase.co:5432/postgres
DIRECT_URL=postgresql://postgres.mdmltksbpdyndoisnqhy:[YOUR-PASSWORD]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres

# ========================================
# ğŸ”´ å¿…éœ€é…ç½® - JWT èªè­‰å¯†é‘°
# ========================================
JWT_SECRET=9hg8PlHMFswnN7FZyfxHOagwqyJ87lZVXQFDKRBc+GY=

# ========================================
# ğŸ”´ å¿…éœ€é…ç½® - Supabase
# ========================================
NEXT_PUBLIC_SUPABASE_URL=https://mdmltksbpdyndoisnqhy.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_3p1ly5-SPsrI5178yr7Qjg_i7OBKEJQ
NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY=sb_secret_PloQCSW91a11td9_ejkaEQ_2faT0bs2
SUPABASE_JWT_SECRET=JFOZVsXpgi6kShGdzmrrNP80yNKUuA9YTCIjsK+gY5ZZcYItaQt9asmRJxXbjhyuK+CMZn7bAEnaJYBT92orEQ==
SUPABASE_ACCESS_TOKEN=sbp_a083055ee9dd7750eb7b2c34026eb56b0bed294c

# ========================================
# ğŸ”´ å¿…éœ€é…ç½® - LINE Botï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
# ========================================
LINE_CHANNEL_ACCESS_TOKEN=tdlFpMlO3GPpiFGq5yuIxcH2Y79OwwjRSE2YydguP0yb7gMbRX1XqgET0WvEM+7NvZBQ4MfJfz9xp8f8pJ9Uzsgcma55Rgc9hwNOap/NrfedXYazKLPLWDww1wPOwjMHA+mFnPOwWJmvVziHuoFaVwdB04t89/1O/w1cDnyilFU=
LINE_CHANNEL_SECRET=f67b75f1f76dad8859df317743d8787c
LINE_USER_ID=U2f7655580a254b416cdb62ae3fd6bb7a

# âš ï¸ é‡è¦ï¼šä½¿ç”¨æ‚¨å·²é…ç½®çš„åŸŸå
LINE_WEBHOOK_URL=https://bossai.tiankai.it.com/api/webhook/line

# æš«æ™‚è·³éç°½åé©—è­‰ï¼ˆåƒ…ç”¨æ–¼èª¿è©¦ï¼ç”Ÿç”¢ç’°å¢ƒè«‹è¨­ç‚º falseï¼‰
LINE_SKIP_SIGNATURE_VERIFY=true

# LINE ç¾¤çµ„ ID é…ç½®
LINE_ADMIN_GROUP_ID=C986ae8b3208735b53872a6d609a7bbe7
LINE_DRIVER_GROUP_ID=C4bfd4b93d29f090fa2b18885d8ad7d12
LINE_SALES_GROUP_ID=C4bfd4b93d29f090fa2b18885d8ad7d12
EMPLOYEE_GROUP_ID=C4bfd4b93d29f090fa2b18885d8ad7d12
ZHANG_GROUP_ID=C986ae8b3208735b53872a6d609a7bbe7

# ========================================
# ğŸŸ¡ å¯é¸é…ç½® - AIï¼ˆåå‘ä»£ç†åˆ°æœ¬åœ°ï¼‰
# ========================================
# æ›¿æ› [YOUR-TUNNEL-URL] ç‚ºæ‚¨çš„ Cloudflare Tunnel æˆ– ngrok URL
# ä¾‹å¦‚ï¼šhttps://ai.yourdomain.com æˆ– https://xxxx-xx-xx-xx-xx.ngrok.io
AI_BASE_URL=https://[YOUR-TUNNEL-URL]
OLLAMA_BASE_URL=https://[YOUR-TUNNEL-URL]

# å¦‚æœä½¿ç”¨ GLM APIï¼ˆé›²ç«¯ AIï¼‰ï¼Œå¯ä»¥é…ç½®é€™å€‹
# GLM_API_KEY=your-glm-api-key
```

---

## ğŸš€ Netlify éƒ¨ç½²é…ç½®

### æ­¥é©Ÿ 1ï¼šå°å…¥ GitHub Repository

1. è¨ªå• https://app.netlify.com/signup
2. ç”¨ GitHub ç™»å…¥
3. Add new site â†’ Import an existing project
4. é¸æ“‡ `csrs885588-hue/line`
5. é»æ“Š Import site

### æ­¥é©Ÿ 2ï¼šé…ç½®æ§‹å»ºè¨­å®š

**Basic build settingsï¼š**
```
Branch to deploy: main
Build command: prisma generate && npm run build
Publish directory: .next
```

**Advanced build settingsï¼ˆç’°å¢ƒè®Šé‡ï¼‰ï¼š**

æ·»åŠ ä»¥ä¸‹ç’°å¢ƒè®Šé‡åˆ° Netlifyï¼š

```bash
# æ•¸æ“šåº«é…ç½®
DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@db.mdmltksbpdyndoisnqhy.supabase.co:5432/postgres
DIRECT_URL=postgresql://postgres.mdmltksbpdyndoisnqhy:[YOUR-PASSWORD]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres

# JWT
JWT_SECRET=9hg8PlHMFswnN7FZyfxHOagwqyJ87lZVXQFDKRBc+GY=

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://mdmltksbpdyndoisnqhy.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_3p1ly5-SPsrI5178yr7Qjg_i7OBKEJQ
NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY=sb_secret_PloQCSW91a11td9_ejkaEQ_2faT0bs2
SUPABASE_JWT_SECRET=JFOZVsXpgi6kShGdzmrrNP80yNKUuA9YTCIjsK+gY5ZZcYItaQt9asmRJxXbjhyuK+CMZn7bAEnaJYBT92orEQ==
SUPABASE_ACCESS_TOKEN=sbp_a083055ee9dd7750eb7b2c34026eb56b0bed294c

# LINE Bot
LINE_CHANNEL_ACCESS_TOKEN=tdlFpMlO3GPpiFGq5yuIxcH2Y79OwwjRSE2YydguP0yb7gMbRX1XqgET0WvEM+7NvZBQ4MfJfz9xp8f8pJ9Uzsgcma55Rgc9hwNOap/NrfedXYazKLPLWDww1wPOwjMHA+mFnPOwWJmvVziHuoFaVwdB04t89/1O/w1cDnyilFU=
LINE_CHANNEL_SECRET=f67b75f1f76dad8859df317743d8787c
LINE_USER_ID=U2f7655580a254b416cdb62ae3fd6bb7a
LINE_WEBHOOK_URL=https://bossai.tiankai.it.com/api/webhook/line
LINE_SKIP_SIGNATURE_VERIFY=true

# LINE ç¾¤çµ„ ID
LINE_ADMIN_GROUP_ID=C986ae8b3208735b53872a6d609a7bbe7
LINE_DRIVER_GROUP_ID=C4bfd4b93d29f090fa2b18885d8ad7d12
LINE_SALES_GROUP_ID=C4bfd4b93d29f090fa2b18885d8ad7d12
EMPLOYEE_GROUP_ID=C4bfd4b93d29f090fa2b18885d8ad7d12
ZHANG_GROUP_ID=C986ae8b3208735b53872a6d609a7bbe7

# AIï¼ˆåå‘ä»£ç†åˆ°æœ¬åœ°ï¼‰
AI_BASE_URL=https://[YOUR-TUNNEL-URL]
OLLAMA_BASE_URL=https://[YOUR-TUNNEL-URL]
```

### æ­¥é©Ÿ 3ï¼šé…ç½®è‡ªå®šç¾©åŸŸåï¼ˆé‡è¦ï¼ï¼‰

**ä½¿ç”¨æ‚¨å·²æœ‰çš„åŸŸåï¼šbossai.tiankai.it.com**

1. åœ¨ Netlify Dashboard é»æ“Š **"Domain management"**
2. é»æ“Š **"Add custom domain"**
3. è¼¸å…¥ï¼š`bossai.tiankai.it.com`
4. é»æ“Š **"Verify"**

**DNS è¨­ç½®ï¼ˆä¸è®Šæ›´å¾Œå° DNSï¼‰**ï¼š

åªéœ€è¦æ·»åŠ ä¸€æ¢ CNAME è¨˜éŒ„ï¼š
```
Type: CNAME
Name: bossai
Value: your-site-name.netlify.app
TTL: 3600
```

âš ï¸ **æ³¨æ„**ï¼š
- ä¸è¦è®Šæ›´å¾Œå°ç¶²ç«™çš„ DNS è¨­ç½®
- åªæ·»åŠ é€™æ¢ CNAME è¨˜éŒ„æŒ‡å‘ Netlify
- LINE Bot åªéœ€è¦ webhook è¯é€šï¼š`https://bossai.tiankai.it.com/api/webhook/line`

### æ­¥é©Ÿ 4ï¼šéƒ¨ç½²

1. é»æ“Š Deploy site
2. ç­‰å¾…æ§‹å»ºå®Œæˆ
3. ç²å¾—ç¶²ç«™ URL

---

## ğŸ”„ æœ¬åœ°èˆ‡é›²ç«¯é€šä¿¡æµç¨‹

### æ­£å¸¸æµç¨‹ï¼š
1. **LINE Bot** æ”¶åˆ°è¨Šæ¯ï¼ˆé›²ç«¯ Netlifyï¼‰
2. **Netlify** è™•ç†è¨Šæ¯ï¼Œéœ€è¦ AI å›æ‡‰
3. **Netlify** é€šéåå‘ä»£ç†ï¼ˆCloudflare Tunnelï¼‰è¨ªå• **æœ¬åœ° Ollama**
4. **æœ¬åœ° Ollama** ç”Ÿæˆ AI å›æ‡‰
5. **å›æ‡‰** è¿”å›åˆ° Netlify
6. **Netlify** ç™¼é€å› LINE Bot

### æ•¸æ“šå­˜å„²ï¼š
- æ‰€æœ‰æ•¸æ“šå­˜å„²åœ¨ **Supabase é›²ç«¯æ•¸æ“šåº«**
- æœ¬åœ°å’Œé›²ç«¯éƒ½å¯ä»¥è¨ªå•åŒä¸€å€‹æ•¸æ“šåº«
- æ•¸æ“šåŒæ­¥ç„¡éœ€é¡å¤–é…ç½®

---

## ğŸ“‹ éƒ¨ç½²å¾Œæª¢æŸ¥æ¸…å–®

### æœ¬åœ°æª¢æŸ¥ï¼š
- [ ] Cloudflare Tunnel æˆ– ngrok æ­£åœ¨é‹è¡Œ
- [ ] æœ¬åœ° Ollama æ­£åœ¨é‹è¡Œï¼ˆ`http://localhost:11434`ï¼‰
- [ ] Tunnel URL å¯ä»¥è¨ªå•ï¼ˆæ¸¬è©¦ï¼š`https://[YOUR-TUNNEL-URL]/api/tags`ï¼‰

### é›²ç«¯æª¢æŸ¥ï¼š
- [ ] Netlify éƒ¨ç½²æˆåŠŸ
- [ ] ç¶²ç«™å¯ä»¥è¨ªå•ï¼ˆ`https://bossai.tiankai.it.com`ï¼‰
- [ ] ç’°å¢ƒè®Šé‡æ­£ç¢ºé…ç½®
- [ ] LINE Webhook URL å·²è¨­ç½®ç‚º `https://bossai.tiankai.it.com/api/webhook/line`
- [ ] LINE Bot å¯ä»¥æ¥æ”¶è¨Šæ¯
- [ ] AI å›æ‡‰æ­£å¸¸ï¼ˆé€šéåå‘ä»£ç†ï¼‰

### æ•¸æ“šåº«æª¢æŸ¥ï¼š
- [ ] Supabase æ•¸æ“šåº«é€£æ¥æ­£å¸¸
- [ ] æ•¸æ“šå¯ä»¥æ­£ç¢ºè®€å¯«
- [ ] Prisma é·ç§»æˆåŠŸåŸ·è¡Œ

---

## ğŸ”’ å®‰å…¨æé†’

### æœ¬åœ° AI æš´éœ²é¢¨éšªï¼š
- âš ï¸ Cloudflare Tunnel / ngrok æœƒæš´éœ²æœ¬åœ° AI æœå‹™
- âš ï¸ ä»»ä½•äººå¦‚æœçŸ¥é“ URL éƒ½å¯ä»¥è¨ªå•

### å®‰å…¨æªæ–½ï¼š
1. **è¨­ç½®è¨ªå•å¯†ç¢¼**ï¼ˆå¦‚æœ Ollama æ”¯æŒï¼‰
2. **å®šæœŸæ›´æ› Tunnel URL**
3. **ç›£æ§è¨ªå•æ—¥èªŒ**
4. **åœ¨ AI æœå‹™å‰æ·»åŠ èªè­‰å±¤**

---

## ğŸ’¡ å„ªåŒ–å»ºè­°

### 1. æ·»åŠ  AI èªè­‰å±¤
å‰µå»ºæœ¬åœ° API ç¶²é—œï¼Œæ·»åŠ èªè­‰ï¼š

```javascript
// local-ai-gateway.js
const express = require('express');
const app = express();

app.use(express.json());

// æ·»åŠ èªè­‰ä¸­é–“ä»¶
app.use((req, res, next) => {
  const authHeader = req.headers['authorization'];
  if (authHeader === `Bearer ${process.env.AI_GATEWAY_SECRET}`) {
    next();
  } else {
    res.status(401).json({ error: 'Unauthorized' });
  }
});

// ä»£ç†åˆ° Ollama
app.all('*', async (req, res) => {
  const response = await fetch(`http://localhost:11434${req.url}`, {
    method: req.method,
    headers: req.headers,
    body: JSON.stringify(req.body)
  });
  const data = await response.json();
  res.json(data);
});

app.listen(3000, () => {
  console.log('AI Gateway running on port 3000');
});
```

ç„¶å¾Œåœ¨ Netlify ç’°å¢ƒè®Šé‡æ·»åŠ ï¼š
```bash
AI_GATEWAY_SECRET=your-secret-key
```

### 2. ä½¿ç”¨ Cloudflare Workers æ·»åŠ ç·©å­˜
å°å¸¸ç”¨ AI å›æ‡‰æ·»åŠ ç·©å­˜ï¼Œæ¸›å°‘æœ¬åœ° AI è² è¼‰ã€‚

---

## ğŸ‰ å®Œæˆå¾Œ

éƒ¨ç½²æˆåŠŸå¾Œï¼š
- âœ… é›²ç«¯ 24/7 å¯è¨ªå•
- âœ… LINE Bot 24/7 é‹è¡Œ
- âœ… æ•¸æ“šå­˜å„²åœ¨é›²ç«¯
- âœ… AI åŠŸèƒ½åœ¨æœ¬åœ°é‹è¡Œï¼ˆé€šéåå‘ä»£ç†ï¼‰
- âœ… ä½¿ç”¨åŸŸåï¼š`https://bossai.tiankai.it.com`
- âœ… å¾Œå° DNS ä¸è®Š
- âœ… ç¸½è²»ç”¨ï¼š$0/æœˆï¼ˆå®Œå…¨å…è²»ï¼‰

---

## ğŸ“ æŠ€è¡“æ”¯æ´

é‡åˆ°å•é¡Œï¼š
1. æª¢æŸ¥ Cloudflare Tunnel æ—¥èªŒ
2. æª¢æŸ¥ Netlify éƒ¨ç½²æ—¥èªŒ
3. æª¢æŸ¥ Ollama æœ¬åœ°æ—¥èªŒ
4. æª¢æŸ¥ Supabase æ—¥èªŒ
