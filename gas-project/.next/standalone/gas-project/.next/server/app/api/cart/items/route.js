"use strict";(()=>{var e={};e.id=233,e.ids=[233],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9931:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>j,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{DELETE:()=>l,GET:()=>c,PATCH:()=>p,POST:()=>u});var a=r(3277),n=r(5265),o=r(5356),i=r(7076),d=r(4118);async function u(e){try{let{productId:t,quantity:r=1,sessionId:s}=await e.json();if(!t||!s)return i.NextResponse.json({error:"productId and sessionId are required"},{status:400});if(!await d.db.product.findUnique({where:{id:t}}))return i.NextResponse.json({error:"Product not found"},{status:404});let a=await d.db.cartItem.findFirst({where:{productId:t,sessionId:s}});if(a){let e=await d.db.cartItem.update({where:{id:a.id},data:{quantity:a.quantity+r}});return i.NextResponse.json(e)}{let e=await d.db.cartItem.create({data:{productId:t,quantity:r,sessionId:s}});return i.NextResponse.json(e)}}catch(e){return console.error("Failed to add to cart:",e),i.NextResponse.json({error:"Failed to add to cart"},{status:500})}}async function c(e){try{let{searchParams:t}=new URL(e.url),r=t.get("sessionId");if(!r)return i.NextResponse.json({error:"sessionId is required"},{status:400});let s=await d.db.cartItem.findMany({where:{sessionId:r},include:{product:{include:{category:!0}}}}),a=s.reduce((e,t)=>e+t.product.price*t.quantity,0);return i.NextResponse.json({items:s,totalAmount:a,itemCount:s.length,totalQuantity:s.reduce((e,t)=>e+t.quantity,0)})}catch(e){return console.error("Failed to fetch cart:",e),i.NextResponse.json({error:"Failed to fetch cart"},{status:500})}}async function p(e){try{let{cartItemId:t,quantity:r,sessionId:s}=await e.json();if(!t||!s)return i.NextResponse.json({error:"cartItemId and sessionId are required"},{status:400});if(r<=0)return await d.db.cartItem.deleteMany({where:{id:t,sessionId:s}}),i.NextResponse.json({success:!0,deleted:!0});let a=await d.db.cartItem.updateMany({where:{id:t,sessionId:s},data:{quantity:r}});return i.NextResponse.json(a)}catch(e){return console.error("Failed to update cart:",e),i.NextResponse.json({error:"Failed to update cart"},{status:500})}}async function l(e){try{let{searchParams:t}=new URL(e.url),r=t.get("cartItemId"),s=t.get("sessionId");if(!r||!s)return i.NextResponse.json({error:"cartItemId and sessionId are required"},{status:400});return await d.db.cartItem.deleteMany({where:{id:r,sessionId:s}}),i.NextResponse.json({success:!0})}catch(e){return console.error("Failed to delete from cart:",e),i.NextResponse.json({error:"Failed to delete from cart"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cart/items/route",pathname:"/api/cart/items",filename:"route",bundlePath:"app/api/cart/items/route"},resolvedPagePath:"C:\\Users\\tian7\\OneDrive\\Desktop\\媽媽ios\\gas-project\\src\\app\\api\\cart\\items\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:h}=m,w="/api/cart/items/route";function j(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},4118:(e,t,r)=>{r.d(t,{db:()=>a});let s=require("@prisma/client"),a=globalThis.prisma??new s.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[942,786],()=>r(9931));module.exports=s})();