"use strict";(()=>{var e={};e.id=577,e.ids=[577],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6087:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var o={};r.r(o),r.d(o,{DELETE:()=>c,GET:()=>u,PUT:()=>p});var s=r(3277),a=r(5265),n=r(5356),i=r(7076),d=r(4118);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("search")||"",o=t.get("categoryId");t.get("status");let s=parseInt(t.get("page")||"1"),a=parseInt(t.get("limit")||"20"),n=t.get("sortBy")||"name",u=t.get("sortOrder")||"asc",p=(s-1)*a,c={};r&&(c.OR=[{name:{contains:r,mode:"insensitive"}},{description:{contains:r,mode:"insensitive"}}]),o&&(c.categoryId=o);let l={};l="price"===n?{price:u}:"stock"===n?{stock:u}:"sales"===n?{sales:u}:"rating"===n?{rating:u}:{sortOrder:u};let[g,m]=await Promise.all([d.db.product.findMany({where:c,include:{category:!0},orderBy:l,skip:p,take:a}),d.db.product.count({where:c})]);return i.NextResponse.json({products:g,pagination:{page:s,limit:a,total:m,totalPages:Math.ceil(m/a)}})}catch(e){return console.error("Failed to fetch products:",e),i.NextResponse.json({error:"Failed to fetch products"},{status:500})}}async function p(e){try{let{id:t,...r}=await e.json(),o=await d.db.product.update({where:{id:t},data:{...r,updatedAt:new Date}});return i.NextResponse.json(o)}catch(e){return console.error("Failed to update product:",e),i.NextResponse.json({error:"Failed to update product"},{status:500})}}async function c(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"Product ID is required"},{status:400});return await d.db.product.delete({where:{id:r}}),i.NextResponse.json({success:!0})}catch(e){return console.error("Failed to delete product:",e),i.NextResponse.json({error:"Failed to delete product"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/products/route",pathname:"/api/admin/products",filename:"route",bundlePath:"app/api/admin/products/route"},resolvedPagePath:"C:\\Users\\tian7\\OneDrive\\Desktop\\媽媽ios\\gas-project\\src\\app\\api\\admin\\products\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:h}=l,x="/api/admin/products/route";function y(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},4118:(e,t,r)=>{r.d(t,{db:()=>s});let o=require("@prisma/client"),s=globalThis.prisma??new o.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[942,786],()=>r(6087));module.exports=o})();