"use strict";(()=>{var e={};e.id=553,e.ids=[553],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1026:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var r={};a.r(r),a.d(r,{GET:()=>d});var s=a(3277),o=a(5265),i=a(5356),n=a(7076),c=a(4118);async function d(e){try{let e=await c.db.product.findMany({include:{category:!0}}),t=await c.db.category.findMany({include:{_count:{select:{products:!0}}}}),a={products:{total:e.length,featured:e.filter(e=>e.featured).length,inStock:e.filter(e=>e.stock>0).length,outOfStock:e.filter(e=>0===e.stock).length,lowStock:e.filter(e=>e.stock>0&&e.stock<5).length,avgPrice:e.length>0?e.reduce((e,t)=>e+t.price,0)/e.length:0,avgRating:e.length>0?e.reduce((e,t)=>e+t.rating,0)/e.length:0,totalSales:e.reduce((e,t)=>e+t.sales,0)},categories:{total:t.length,byCategory:t.map(t=>({id:t.id,name:t.name,slug:t.slug,productCount:t._count?.products||0,totalStock:e.filter(e=>e.categoryId===t.id).reduce((e,t)=>e+t.stock,0),totalSales:e.filter(e=>e.categoryId===t.id).reduce((e,t)=>e+t.sales,0)}))},sales:{total:e.reduce((e,t)=>e+t.sales,0),topProducts:e.sort((e,t)=>t.sales-e.sales).slice(0,10).map(e=>({id:e.id,name:e.name,sales:e.sales,price:e.price,categoryName:t.find(t=>t.id===e.categoryId)?.name||"-"}))},alerts:{outOfStock:e.filter(e=>0===e.stock).map(e=>({id:e.id,name:e.name,categoryName:t.find(t=>t.id===e.categoryId)?.name||"-"})),lowStock:e.filter(e=>e.stock>0&&e.stock<5).sort((e,t)=>e.stock-t.stock).slice(0,10).map(e=>({id:e.id,name:e.name,stock:e.stock,categoryName:t.find(t=>t.id===e.categoryId)?.name||"-"}))}};return n.NextResponse.json(a)}catch(e){return console.error("Failed to get admin stats:",e),n.NextResponse.json({error:"Failed to get admin stats"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/stats/route",pathname:"/api/admin/stats",filename:"route",bundlePath:"app/api/admin/stats/route"},resolvedPagePath:"C:\\Users\\tian7\\OneDrive\\Desktop\\媽媽ios\\gas-project\\src\\app\\api\\admin\\stats\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:g}=l,m="/api/admin/stats/route";function f(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},4118:(e,t,a)=>{a.d(t,{db:()=>s});let r=require("@prisma/client"),s=globalThis.prisma??new r.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[942,786],()=>a(1026));module.exports=r})();