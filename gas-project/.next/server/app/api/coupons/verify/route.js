"use strict";(()=>{var e={};e.id=753,e.ids=[753],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2218:(e,o,r)=>{r.r(o),r.d(o,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var t={};r.r(t),r.d(t,{POST:()=>p});var n=r(3277),i=r(5265),s=r(5356),a=r(7076),u=r(4118);async function p(e){try{let{code:o,orderAmount:r}=await e.json();if(!o)return a.NextResponse.json({error:"Coupon code is required"},{status:400});let t=await u.db.coupon.findUnique({where:{code:o}});if(!t)return a.NextResponse.json({valid:!1,error:"Coupon not found"});let n=new Date;if(!t.isActive)return a.NextResponse.json({valid:!1,error:"Coupon is inactive"});if(new Date(t.validFrom)>n)return a.NextResponse.json({valid:!1,error:"Coupon not yet valid"});if(new Date(t.validTo)<n)return a.NextResponse.json({valid:!1,error:"Coupon has expired"});if(t.usageLimit&&t.usedCount>=t.usageLimit)return a.NextResponse.json({valid:!1,error:"Coupon usage limit reached"});if(t.minAmount&&r&&r<t.minAmount)return a.NextResponse.json({valid:!1,error:`Minimum order amount is NT$${t.minAmount}`});let i=0;return"percentage"===t.discountType?(i=t.discountValue/100*(r||0),t.maxAmount&&i>t.maxAmount&&(i=t.maxAmount)):i=t.discountValue,a.NextResponse.json({valid:!0,coupon:{id:t.id,code:t.code,name:t.name,discountType:t.discountType,discountValue:t.discountValue},discountAmount:i,message:`Coupon applied! You save NT$${i.toLocaleString()}`})}catch(e){return console.error("Failed to verify coupon:",e),a.NextResponse.json({error:"Failed to verify coupon"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/coupons/verify/route",pathname:"/api/coupons/verify",filename:"route",bundlePath:"app/api/coupons/verify/route"},resolvedPagePath:"C:\\Users\\tian7\\OneDrive\\Desktop\\媽媽ios\\gas-project\\src\\app\\api\\coupons\\verify\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=d,v="/api/coupons/verify/route";function x(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},4118:(e,o,r)=>{r.d(o,{db:()=>n});let t=require("@prisma/client"),n=globalThis.prisma??new t.PrismaClient({log:["query"]})}};var o=require("../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[942,786],()=>r(2218));module.exports=t})();