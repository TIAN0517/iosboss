"use strict";(()=>{var e={};e.id=475,e.ids=[475],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7888:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>x,patchFetch:()=>w,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var r={};o.r(r),o.d(r,{GET:()=>p,POST:()=>c});var n=o(3277),s=o(5265),a=o(5356),i=o(7076),u=o(4118);async function p(e){try{let{searchParams:t}=new URL(e.url),o=t.get("code");if(o){let e=await u.db.coupon.findUnique({where:{code:o}});if(!e)return i.NextResponse.json({error:"Coupon not found"},{status:404});let t=new Date;if(!e.isActive||new Date(e.validFrom)>t||new Date(e.validTo)<t)return i.NextResponse.json({error:"Coupon is expired or inactive"},{status:400});if(e.usageLimit&&e.usedCount>=e.usageLimit)return i.NextResponse.json({error:"Coupon usage limit reached"},{status:400});return i.NextResponse.json(e)}{let e=await u.db.coupon.findMany({where:{isActive:!0,validTo:{gte:new Date}},orderBy:{createdAt:"desc"}});return i.NextResponse.json(e)}}catch(e){return console.error("Failed to fetch coupons:",e),i.NextResponse.json({error:"Failed to fetch coupons"},{status:500})}}async function c(e){try{let{code:t,name:o,description:r,discountType:n,discountValue:s,minAmount:a,maxAmount:p,usageLimit:c,validTo:d}=await e.json();if(!t||!o||!n||!s)return i.NextResponse.json({error:"code, name, discountType, and discountValue are required"},{status:400});let l=await u.db.coupon.create({data:{code:t,name:o,description:r,discountType:n,discountValue:s,minAmount:a,maxAmount:p,usageLimit:c,validTo:new Date(d||Date.now()+2592e6),validFrom:new Date,isActive:!0,usedCount:0}});return i.NextResponse.json(l)}catch(e){return console.error("Failed to create coupon:",e),i.NextResponse.json({error:"Failed to create coupon"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/coupons/route",pathname:"/api/coupons",filename:"route",bundlePath:"app/api/coupons/route"},resolvedPagePath:"C:\\Users\\tian7\\OneDrive\\Desktop\\媽媽ios\\gas-project\\src\\app\\api\\coupons\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:v}=d,x="/api/coupons/route";function w(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},4118:(e,t,o)=>{o.d(t,{db:()=>n});let r=require("@prisma/client"),n=globalThis.prisma??new r.PrismaClient({log:["query"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[942,786],()=>o(7888));module.exports=r})();