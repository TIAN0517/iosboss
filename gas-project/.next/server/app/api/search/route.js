"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9298:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>u,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>p});var i=r(3277),s=r(5265),n=r(5356),o=r(7076),c=r(4118);async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("q")||"",a=t.get("categoryId"),i=t.get("minPrice"),s=t.get("maxPrice"),n=t.get("sortBy")||"relevance",p=parseInt(t.get("page")||"1"),d=parseInt(t.get("limit")||"20");if(!r.trim()&&!a)return o.NextResponse.json({results:[],pagination:{page:p,limit:d,total:0,totalPages:0},suggestions:[]});let l={};r.trim()&&(l.OR=[{name:{contains:r,mode:"insensitive"}},{description:{contains:r,mode:"insensitive"}}]),a&&(l.categoryId=a),(i||s)&&(l.price={},i&&(l.price.gte=parseFloat(i)),s&&(l.price.lte=parseFloat(s)));let g={};switch(n){case"price-asc":g={price:"asc"};break;case"price-desc":g={price:"desc"};break;case"sales":g={sales:"desc"};break;case"rating":g={rating:"desc"};break;case"newest":g={createdAt:"desc"};break;default:g=[{featured:"desc"},{sales:"desc"},{rating:"desc"}]}let[u,m]=await Promise.all([c.db.product.findMany({where:l,include:{category:!0},orderBy:g,skip:(p-1)*d,take:d}),c.db.product.count({where:l})]),y=[];if(r.trim()){let e=(await c.db.category.findMany()).filter(e=>e.name.toLowerCase().includes(r.toLowerCase())).map(e=>({type:"category",id:e.id,text:e.name,icon:e.icon})),t=u.slice(0,5).map(e=>({type:"product",id:e.id,text:e.name,price:e.price,imageUrl:e.imageUrl}));y=[...e,...t]}return o.NextResponse.json({results:u.map(e=>({id:e.id,name:e.name,description:e.description,price:e.price,imageUrl:e.imageUrl,stock:e.stock,categoryId:e.categoryId,categoryName:e.category?.name,categorySlug:e.category?.slug,categoryIcon:e.category?.icon,featured:e.featured,rating:e.rating,sales:e.sales})),pagination:{page:p,limit:d,total:m,totalPages:Math.ceil(m/d)},suggestions:y.slice(0,10),filters:{categories:await c.db.category.findMany(),priceRange:{min:u.length>0?Math.min(...u.map(e=>e.price)):0,max:u.length>0?Math.max(...u.map(e=>e.price)):0}}})}catch(e){return console.error("Search error:",e),o.NextResponse.json({error:"Search failed",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"C:\\Users\\tian7\\OneDrive\\Desktop\\媽媽ios\\gas-project\\src\\app\\api\\search\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:u}=d,m="/api/search/route";function y(){return(0,n.patchFetch)({serverHooks:u,staticGenerationAsyncStorage:g})}},4118:(e,t,r)=>{r.d(t,{db:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient({log:["query"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[942,786],()=>r(9298));module.exports=a})();