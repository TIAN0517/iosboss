"use strict";(()=>{var e={};e.id=495,e.ids=[495],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},4871:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>b,requestAsyncStorage:()=>A,routeModule:()=>y,serverHooks:()=>$,staticGenerationAsyncStorage:()=>I});var a={};r.r(a),r.d(a,{POST:()=>w});var i=r(3277),o=r(5265),n=r(5356),s=r(7076);let c=require("fs/promises");var d=r(5315),h=r.n(d);let l=require("os"),u=async()=>{let e=l.homedir();for(let t of[d.join(process.cwd(),".z-ai-config"),d.join(e,".z-ai-config"),"/etc/.z-ai-config"])try{let e=await c.readFile(t,"utf-8"),r=JSON.parse(e);if(r.baseUrl&&r.apiKey)return r}catch(e){"ENOENT"!==e.code&&console.error(`Error reading or parsing config file at ${t}:`,e)}throw Error("Configuration file not found or invalid. Please create .z-ai-config in your project, home directory, or /etc.")};class p{constructor(e){this.config=e,this.chat={completions:{create:this.createChatCompletion.bind(this),createVision:this.createChatCompletionVision.bind(this)}},this.audio={tts:{create:this.createAudioTTS.bind(this)},asr:{create:this.createAudioASR.bind(this)}},this.images={generations:{create:this.createImageGeneration.bind(this)}},this.video={generations:{create:this.createVideoGeneration.bind(this)}},this.async={result:{query:this.queryAsyncResult.bind(this)}},this.functions={invoke:this.invokeFunction.bind(this)}}static async create(){return new p(await u())}async createChatCompletion(e){let{baseUrl:t,chatId:r,userId:a,apiKey:i}=this.config,o=`${t}/chat/completions`,n={"Content-Type":"application/json",Authorization:`Bearer ${i}`,"X-Z-AI-From":"Z"};r&&(n["X-Chat-Id"]=r),a&&(n["X-User-Id"]=a);let s={...e,thinking:e.thinking||{type:"disabled"}};try{let e=await fetch(o,{method:"POST",headers:n,body:JSON.stringify(s)});if(!e.ok){let t=await e.text();throw Error(`API request failed with status ${e.status}: ${t}`)}let t=e.headers.get("content-type")||"";if(s.stream&&(t.includes("text/event-stream")||t.includes("text/plain")))return e.body;return await e.json()}catch(e){throw console.error("Failed to make API request:",e),e}}async createChatCompletionVision(e){let{baseUrl:t,chatId:r,userId:a,apiKey:i}=this.config,o=`${t}/chat/completions/vision`,n={"Content-Type":"application/json",Authorization:`Bearer ${i}`,"X-Z-AI-From":"Z"};r&&(n["X-Chat-Id"]=r),a&&(n["X-User-Id"]=a);let s={...e,thinking:e.thinking||{type:"disabled"}};try{let e=await fetch(o,{method:"POST",headers:n,body:JSON.stringify(s)});if(!e.ok){let t=await e.text();throw Error(`API request failed with status ${e.status}: ${t}`)}let t=e.headers.get("content-type")||"";if(s.stream&&(t.includes("text/event-stream")||t.includes("text/plain")))return e.body;return await e.json()}catch(e){throw console.error("Failed to make vision API request:",e),e}}async createAudioTTS(e){let{baseUrl:t,chatId:r,userId:a,apiKey:i}=this.config,o=`${t}/audio/tts`,n={"Content-Type":"application/json",Authorization:`Bearer ${i}`,"X-Z-AI-From":"Z"};r&&(n["X-Chat-Id"]=r),a&&(n["X-User-Id"]=a);try{let t=await fetch(o,{method:"POST",headers:n,body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error(`API request failed with status ${t.status}: ${e}`)}return t}catch(e){throw console.error("Failed to make TTS API request:",e),e}}async createAudioASR(e){let{baseUrl:t,chatId:r,userId:a,apiKey:i}=this.config,o=`${t}/audio/asr`,n={"Content-Type":"application/json",Authorization:`Bearer ${i}`,"X-Z-AI-From":"Z"};r&&(n["X-Chat-Id"]=r),a&&(n["X-User-Id"]=a);try{let t=await fetch(o,{method:"POST",headers:n,body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error(`API request failed with status ${t.status}: ${e}`)}return await t.json()}catch(e){throw console.error("Failed to make ASR API request:",e),e}}async createImageGeneration(e){let{baseUrl:t,apiKey:r,chatId:a,userId:i}=this.config,o=`${t}/images/generations`,n={"Content-Type":"application/json",Authorization:`Bearer ${r}`,"X-Z-AI-From":"Z"};a&&(n["X-Chat-Id"]=a),i&&(n["X-User-Id"]=i);let s={...e};try{let e=await fetch(o,{method:"POST",headers:n,body:JSON.stringify(s)});if(!e.ok){let t=await e.text();throw Error(`API request failed with status ${e.status}: ${t}`)}let t=await e.json(),r=await Promise.all(t.data.map(async e=>e.url?{base64:await this.downloadImageAsBase64(e.url),format:"png"}:e));return{...t,data:r}}catch(e){throw console.error("Failed to make image generation request:",e),e}}async downloadImageAsBase64(e){try{let t=await fetch(e);if(!t.ok)throw Error(`Failed to download image: ${t.status}`);let r=await t.arrayBuffer(),a=Buffer.from(r).toString("base64");return`${a}`}catch(e){throw console.error("Failed to download and convert image to base64:",e),e}}async createVideoGeneration(e){let{baseUrl:t,apiKey:r,chatId:a,userId:i}=this.config,o=`${t}/video/generation`,n={"Content-Type":"application/json",Authorization:`Bearer ${r}`,"X-Z-AI-From":"Z"};a&&(n["X-Chat-Id"]=a),i&&(n["X-User-Id"]=i);try{let t=await fetch(o,{method:"POST",headers:n,body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error(`API request failed with status ${t.status}: ${e}`)}return await t.json()}catch(e){throw console.error("Failed to make video generation request:",e),e}}async queryAsyncResult(e){let{baseUrl:t,apiKey:r,chatId:a,userId:i}=this.config,o=`${t}/async-result?id=${encodeURIComponent(e)}`,n={Authorization:`Bearer ${r}`,"X-Z-AI-From":"Z"};a&&(n["X-Chat-Id"]=a),i&&(n["X-User-Id"]=i);try{let e=await fetch(o,{method:"GET",headers:n});if(!e.ok){let t=await e.text();throw Error(`API request failed with status ${e.status}: ${t}`)}return await e.json()}catch(e){throw console.error("Failed to query async result:",e),e}}async invokeFunction(e,t){let{baseUrl:r,apiKey:a,chatId:i,userId:o}=this.config,n=`${r}/functions/invoke`,s={"Content-Type":"application/json",Authorization:`Bearer ${a}`,"X-Z-AI-From":"Z"};i&&(s["X-Chat-Id"]=i),o&&(s["X-User-Id"]=o);try{let r=await fetch(n,{method:"POST",headers:s,body:JSON.stringify({function_name:e,arguments:t})});if(!r.ok){let e=await r.text();throw Error(`Function invoke failed with status ${r.status}: ${e}`)}return(await r.json()).result}catch(e){throw console.error("Failed to invoke remote function:",e),e}}}let m=require("fs");var f=r.n(m);let g="./public/products";async function w(e){try{let{prompt:t,filename:r,size:a="1024x1024"}=await e.json();if(!t||!r)return s.NextResponse.json({error:"Prompt and filename are required"},{status:400});console.log(`Generating image: ${r} with prompt: ${t}`);let i=await p.create(),o=(await i.images.generations.create({prompt:t,size:a})).data[0].base64,n=Buffer.from(o,"base64"),c=h().join(g,r);return f().writeFileSync(c,n),console.log(`✓ Generated: ${r}`),s.NextResponse.json({success:!0,imageUrl:`/products/${r}`,prompt:t,size:a})}catch(e){return console.error("Image generation error:",e),s.NextResponse.json({error:e.message||"Failed to generate image"},{status:500})}}f().existsSync(g)||f().mkdirSync(g,{recursive:!0});let y=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/generate-image/route",pathname:"/api/generate-image",filename:"route",bundlePath:"app/api/generate-image/route"},resolvedPagePath:"C:\\Users\\tian7\\OneDrive\\Desktop\\媽媽ios\\gas-project\\src\\app\\api\\generate-image\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:A,staticGenerationAsyncStorage:I,serverHooks:$}=y,k="/api/generate-image/route";function b(){return(0,n.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:I})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[942,786],()=>r(4871));module.exports=a})();