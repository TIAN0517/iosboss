// 知識庫相關表結構 - 新增到 schema.prisma

model KnowledgeBase {
  id          String   @id @default(cuid())
  title       String
  category    String
  content     String   @db.Text
  keywords    String[]
  priority    Int      @default(0)
  isActive    Boolean  @default(true)
  viewCount   Int      @default(0)
  usageCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  keywordsRelations KnowledgeKeyword[]
  usageLogs     KnowledgeUsageLog[]
  embeddings    KnowledgeEmbedding[]

  @@index([category])
  @@index([isActive])
  @@index([priority])
  @@map("knowledge_base")
}

model KnowledgeKeyword {
  id              String        @id @default(cuid())
  knowledgeBaseId String
  keyword         String
  createdAt       DateTime      @default(now())
  
  knowledgeBase   KnowledgeBase @relation(fields: [knowledgeBaseId], references: [id], onDelete: Cascade)

  @@index([keyword])
  @@map("knowledge_keywords")
}

model KnowledgeUsageLog {
  id              String        @id @default(cuid())
  knowledgeBaseId String
  userId          String?
  query           String        @db.Text
  matchScore      Float?
  timestamp       DateTime      @default(now())
  
  knowledgeBase   KnowledgeBase @relation(fields: [knowledgeBaseId], references: [id], onDelete: Cascade)

  @@index([knowledgeBaseId])
  @@index([timestamp])
  @@map("knowledge_usage_logs")
}

// 向量搜索相關表 - 方案B升級時使用
model KnowledgeEmbedding {
  id              String        @id @default(cuid())
  knowledgeBaseId String
  chunkIndex      Int
  chunkContent    String        @db.Text
  embedding       Unsupported("vector(1536)") // 使用OpenAI embedding維度
  metadata        Json?
  createdAt       DateTime      @default(now())
  
  knowledgeBase   KnowledgeBase @relation(fields: [knowledgeBaseId], references: [id], onDelete: Cascade)

  @@index([knowledgeBaseId])
  @@map("knowledge_embeddings")
}
